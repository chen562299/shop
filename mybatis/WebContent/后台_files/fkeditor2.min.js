(function(E,P,e,Z,l){var f=Z,ag=f.top.Site,V=P.getSelection?false:true,p=navigator.userAgent.toLowerCase(),z=p.indexOf("se")>-1,r=p.indexOf("firefox")>-1,J=p.indexOf("opera")>-1,I="",C="unselectable",ab=V?((e.selection&&e.selection.createRange&&e.selection.type!="None")?e.selection.createRange():l):P.getSelection(),o={OuterFun:"outerFun",Option:"option",Editor:"editor",HasRefreshClick:"hrfc",LinkHasClick:"linkHasClick",SignClassNum:"scn",HasRsChildStyle:"hrcs",Range:"range",NotCreateNewNode:"ncnn",SimpleTextEdit:"simpleTextEdit",HasSelectText:"hst",ClearSpanCursoring:"cscs",OldVHeight:"ovht",OldHwidth:"ohwt",HoverToolOn:"hoverToolOn",FloatImg:"floatImg",HoverToolTimeout:"htto",EditLineTimeout:"etto",SignClassNum:"signClassNum",SetPageChange:"spce",HasRemoveUselessChild:"rucsc",RemoveUselessChildIng:"rucscing",PreScrollHeight:"psht",ChangeCount:"changeCount",ScrollChangeChecking:"sccg",FirstChooseEditor:"fcet",PreHtmlContent:"phct",Onfocused:"onfocused",PreModuleHeight:"pmheight",Mousedown:"mousedown",Mousemove:"mousemove",FixRight:"fixRight",ScreenX:"screenX",ScreenY:"screenY",ModuleId:"moduleId",PreCommand:"preCommand",SelectedInputBlur:"sib",TriggerClick:"ectc",EndCheckClass:"endCheckClass",EditSignClass:"editSignClass",EditorEventBind:"editorEventBind"},N={Contenteditable:"contenteditable",Emphasis:"emphasis"};BtnCommand={EditContent:"editContent",EditPositionFixed:"positionFixed",EditLogoDisplay:"logoDisplay",GlobalLink:"globalLink",Opacity:"opacity",Border:"border",Shadow:"shadow",Radius:"radius",Delete:"delete",FontSize:"fSize",LineHeight:"lineHeight",Animation:"animation",BtnModuleStyle:"btnModuleStyle",Linkcreator:"linkcreator",Formats:"formats",Colors:"colors",Removeformat:"removeformat",TextAlign:"textAlign",JustifyLeft:"justifyLeft",JustifyCenter:"justifyCenter",JustifyRight:"justifyRight",WritingMode:"writingMode",Bold:"Bold",Italic:"Italic",Underline:"Underline",Unlink:"Unlink",Createlink:"Createlink",SingleClick:"singleClick",Dblclick:"dblclick",InputFontSize:"inputFontSize",InputLineHeight:"inputLineHeight",ChooseFormats:"chooseFormats",ChooseLineHeight:"chooseLineHeight",ChooseFontSize:"chooseFontSize",DeleteLink:"deleteLink"};ag.simpleTextList={allEditors:[],chooseEditor:{},colorToolShow:false,checking:false};if(/msie/.test(p)){I="-ms-"}else{if(/chrome/.test(p)||/safari/.test(p)||/yandex/.test(p)){I="-webkit-"}else{if(r){I="-moz-"}else{if(J){I="-o-"}else{if(/konqueror/.test(p)){I="-khtml-"}else{I=""}}}}}var ae,ac,h,H,T,R,u;var y=function(){this.constructor.prototype.extend=function(aj,ai){for(var ah in ai){if(!(ah in ai.constructor.prototype)){aj[ah]=ai[ah]}}for(var ah in ai.constructor.prototype){aj.constructor.prototype[ah]=ai[ah]}}};ae=new y();var v=function(){this.constructor.prototype.test=function(){return true}};ac=new v();var d=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var al=this;al.constructor.prototype.changeParentStyle=function(aq){var au=aq.element,at=aq.styleName,an=aq.styleValue,ap=aq.endCheckClass;if(typeof(au.parent())==l){return aj}var am=au.parent();if(am.hasClass(ap)){return aj}if(au.text().length==am.text().length){am.css(at,"");aq.element=am;al.changeParentStyle(aq)}for(var ar=0;ar<am.children().length;ar++){var ao=am.children().eq(ar);if(ao.text().length<=0&&ao.html().indexOf("br")<0&&ao.html().indexOf("nbsp")<0){ao.replaceWith("")}}return aj};al.constructor.prototype.changeChildStyle=function(ao){var ar=ao.element,aq=ao.styleName,am=ao.styleValue;if(typeof(ar.children)==l){return aj}for(var ap=0;ap<ar.children().length;ap++){var an=ar.children().eq(ap);an.css(aq,"");ao.element=an;al.changeChildStyle(ao)}return aj};al.constructor.prototype.setElementStyleEffectAll=function(ap){var ar=ap.element,ao=ap.effectElement,aq=ap.styleName,am=ap.styleValue,at=ap.elemenText,an=ap.endCheckClass;if(ar&&ar.length>0){ar.find("*").css(aq,"");ar.find(ao).css(aq,am)}ap.element=ar;al.setElementParentStyleEffectAll(ap);return aj};al.constructor.prototype.setElementParentStyleEffectAll=function(ap){var ao=ap.element,aq=ap.effectElement,an=ap.styleName,av=ap.styleValue,au=ap.elemenText,ar=ap.endCheckClass,at=ao.parent();if(typeof(at)==l){return aj}if(at.hasClass(ar)||E.trim(at.text())!=au){return aj}var am=at[0].tagName.toLowerCase();if(am==aq){at.css(an,av)}else{if(typeof(at.css(an))!=l){at.css(an,"")}}ap.element=at;al.setElementParentStyleEffectAll(ap);return aj};al.constructor.prototype.checkInArray=function(ao,an){for(var am=0;am<ao.length;am++){if(ao[am]==an){return true}}return false};al.constructor.prototype.findTagInParent=function(aq,ap,ao){var an=false;if(typeof(aq.parent())==l||aq.parent().length<=0){return an}var am=aq.parent();if(am.hasClass(ao)){return an}var ar=am[0].tagName.toLowerCase();if(ar==ap){return am}else{return al.findTagInParent(am,ap,ao)}return an};al.constructor.prototype.filterPasteData=function(au){var ax=["div","span","font","p","u","i","br","b","a","strong","em"],az=["font-size","line-height","text-align","color","font-family"],an,ap,am,aw,ar,av,ao,aA,ay;if(typeof(au.children)==l||au.children().length<=0){return aj}for(var at=0;at<au.children().length;at++){ap=au.children().eq(at);an=E.trim(ap.prop("tagName").toLowerCase());if(!al.checkInArray(ax,an)){ap.prop("outerHTML",ap.text());continue}am=ap.attr("style");if(typeof(am)==l||am.length<=0){continue}am=am.toLowerCase();ay=am.split(";");if(ay.length<=0){continue}aw=false;ar=[];for(var aq=0;aq<ay.length;aq++){if(typeof(ay[aq])==l){aw=true;continue}av=ay[aq].split(":");if(typeof(av)==l||av.length!=2){aw=true;continue}ao=av[0];if(ao.indexOf(",")>0){ao=ao.substring(ao.lastIndexOf(","))}aA=av[1];ao=E.trim(ao);if(!al.checkInArray(az,ao)){aw=true;continue}if(ao=="font-size"||ao=="line-height"){if(aA.indexOf("px")<0){ay[aq]=""}else{aw=true}}ar.push(ay[aq]+";")}if(aw){ap.attr("style",ar.join(""))}}return aj};al.constructor.prototype.textPositionCorrect=function(ao){if(ao.find("div").length>0||ao.find("p")>0){return aj}if(typeof(ao.children)==l||ao.children().length<=0){return aj}for(var an=0;an<ao.children().length;an++){var am=ao.children().eq(an);if(typeof(am.attr("style"))!=l&&am.attr("style")&&am.attr("style").indexOf("text-align")!=-1&&am.css("display")!="block"){am.css("display","block")}al.textPositionCorrect(am)}return aj};al.constructor.prototype.setUnselectable=function(am){am.fkEditorWrap.find("["+C+"]").css(I+"user-select","none").attr(C,"on").on("selectstart mousedown",false);am.toolbar.find(".simpleTextEditTool").find("["+C+"]").css(I+"user-select","none").attr(C,"on").on("selectstart mousedown",false);return aj};al.constructor.prototype.removeUselessChildStyle=function(av,au){if(!av.data(o.SetPageChange)||av.data(o.HasRemoveUselessChild)==true){return}if(typeof(au.children())==l){return}var ap,ax,am,ao,an,aq,aw,ar;for(var at=0;at<au.children().length;at++){ap=au.children().eq(at);am=ap.attr("class");ar=(typeof(am)==l||am=="");ax=au.parent();if((ao=="span"||ao=="font"||ao=="a")&&ap.text().length<=0&&ar&&ap.html().indexOf("br")<=0){ap.replaceWith("");return}if(ar){ao=ap.prop("tagName").toLowerCase();an=ap.attr("style");aq=ap.attr("color");aw=ap.attr("face");if((typeof(an)==l||an=="")&&(ao=="span"||(ao=="font"&&typeof(aq)==l&&typeof(aw)==l))){ap.replaceWith(ap.html());ap=ax}}al.removeUselessChildStyle(av,ap)}};al.constructor.prototype.removeElementProp=function(an){var aq=an.element,ap=an.attrName,am,ar;ar=aq.attr(ap);if(typeof(ar)!=l&&ar!=""){aq.removeAttr(ap)}for(var ao=0;ao<aq.children().length;ao++){am=aq.children().eq(ao);ar=am.attr(ap);if(typeof(ar)!=l&&ar!=""){am.removeAttr(ap)}al.removeElementProp({element:am,attrName:ap})}};al.constructor.prototype.setElementStyle=function(ao){var ar=ao.element,aq=ao.styleName,am=ao.styleValue,an,at;ar.css(aq,am);for(var ap=0;ap<ar.children().length;ap++){an=ar.children().eq(ap);an.css(aq,am);al.setElementStyle({element:an,styleName:aq,styleValue:am})}}};return ai=new ak()};this.getUICtrl=function(){}};T=new d();var G=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var al=this;var am=new Date().getTime();var an=new Date().getTime();al.constructor.prototype.getWindowSelection=function(){if(!V){return P.getSelection()}if(al.checkSelectionRange()){return e.selection.createRange()}return ab};al.constructor.prototype.checkIEGetSelection=function(){var ao=al.getWindowSelection(),ap="baseOffset";if(!ao){return false}if(ap in ao&&ao.baseOffset==0){return false}return true};al.constructor.prototype.isNumberPress=function(ao){if(ao>=48&&ao<=57){return true}if(ao>=96&&ao<=105){return true}if(ao==8||ao==46||ao==37||ao==39){return true}return false};al.constructor.prototype.checkSelectionRange=function(){return e.selection&&e.selection.createRange&&e.selection.type!="None"};al.constructor.prototype.getSelectedNode=function(){var ap,aq=al.getWindowSelection(),ao;if(!V){ap=aq.anchorNode}if(!ap&&al.checkSelectionRange()){aq=e.selection;var ao=aq.getRangeAt?aq.getRangeAt(0):aq.createRange();ap=ao.commonAncestorContainer?ao.commonAncestorContainer:ao.parentElement?ao.parentElement():ao.item(0)}return ap?(ap.nodeName=="#text"?E(ap.parentNode):E(ap)):false};al.constructor.prototype.detectElement=function(aq){var ap=aq.tags,at=false,ao,ar=al.getSelectedNode();if(ar){ao=ar.prop("tagName").toLowerCase();E.each(ap,function(au,av){if(ao==av){at=true;return false}});if(at){return at}ar.parents().each(function(){ao=E(this).prop("tagName").toLowerCase();E.each(ap,function(au,av){if(ao==av){at=true;return false}});if(at){return false}});return at}return false};al.constructor.prototype.detectElementCss=function(at){var aq=al.getSelectedNode(),ap="fk-editor",ar,ao;if(r&&aq&&aq.length>0&&aq.hasClass(ap)){ao=al.detectElementDeepCss(aq,at);if(ao==""){ao=aq.css(at)}return ao}if(at&&aq){return aq.css(at)}return""};al.constructor.prototype.detectElementDeepCss=function(aq,at){var ao="",ar=aq.text().length;if(ar<=0){return ao}if(aq.children().length<=0&&ar>0){ao=aq.css(at);return ao}for(var ap=0;ap<aq.children().length;ap++){ao=al.detectElementDeepCss(aq.children().eq(ap),at);if(ao!=""){break}}return ao};al.constructor.prototype.refuseStyle=function(ar){var aq=al.getSelectedNode();if(aq&&aq.is("[style]")&&aq.css(ar)!=""){var ao=aq.css(ar),ap;aq.css(ar,"");ap=aq.attr("style");aq.css(ar,ao);return ap}return""};al.constructor.prototype.setSelection=function(at,ar){var ao,ap=al.getWindowSelection();if(V){ap.execCommand(at,false,ar)}else{if(ap.anchorNode&&ap.getRangeAt){ao=ap.getRangeAt(0)}if(ao){ap.removeAllRanges();ap.addRange(ao)}if(!p.match(/msie/)){e.execCommand("StyleWithCSS",false,false)}try{e.execCommand(at,false,ar)}catch(aq){console.log(aq)}}al.affectStyleAround(false,true);return aj};al.constructor.prototype.affectStyleAround=function(ap,aq){var ar=al.getSelectedNode();ar=ar?ar:ap;if(ar&&aq==false){if(ar.parent().is("[style]")){ar.attr("style",ar.parent().attr("style"))}if(ar.is("[style]")){ar.find("*").attr("style",ar.attr("style"))}return aj}if(ap&&aq&&ap.is("[style]")){var ao=aq.split(";");ao=ao[0].split(":");if(ao[0]=="color"){var at=false;ap.find("*").each(function(au,av){if(au==0&&E(this).attr("color")||E(this).parent().attr("color")){at=true}if(!E(this).attr("color")){if(!at){E(this).css(ao[0],ao[1])}}})}else{if(ap.is("[style*="+ao[0]+"]")){ap.find("*").css(ao[0],ao[1])}}al.selectText(ap)}return aj};al.constructor.prototype.selectText=function(ap){if(ab==l||!ap){return aj}var ap=ap[0],ao,aq=al.getWindowSelection();if(V){aq.moveToElementText(ap);aq.select();return aj}if(typeof(ap)==l||ap==null){return aj}ao=e.createRange();ao.selectNodeContents(ap);aq.removeAllRanges();aq.addRange(ao);if(E(ap).is(":empty")){E(ap).append("&nbsp;");al.selectText(E(ap))}return aj};al.constructor.prototype.setNodeRange=function(ar){if(typeof(ar)==l){return}if(V){return aj}try{var ao,ap,at=al.getWindowSelection();at.removeAllRanges();ao=ar.childNodes;if(ao&&ao.length>0){for(var aq=0;aq<ao.length;aq++){var ap=e.createRange();ap.selectNode(ao[aq]);at.addRange(ap)}return aj}ap=e.createRange();ap.selectNode(ar);at.addRange(ap)}catch(au){console.log(au)}return aj};al.constructor.prototype.getSelectText=function(aq,ap){var at="",ao,ar=al.getWindowSelection();if(!V&&ar.anchorNode&&ar.getRangeAt){ao=ar.getRangeAt(0);if(!ap){aq.data(o.Range,ao)}at=ao.toString()}if(V&&ab!=l){if(!ap){aq.data(o.Range,ar)}at=ar.htmlText}return at};al.constructor.prototype.setSelectRange=function(ao){if(ao==null){return aj}var ap=al.getWindowSelection();if(!V){ap.removeAllRanges();al.getWindowSelection().addRange(ao);return aj}if(al.checkSelectionRange()){e.selection.createRangeCollection(ao)}return aj};al.constructor.prototype.setTagStyle=function(ao){if(typeof(ao.styleName)==l){ao.styleName=""}if(typeof(ao.styleValue)==l){ao.styleValue=""}var aq=al.refuseStyle(ao.styleName),ap={};if(typeof(aq)==l){aq=""}if(typeof(ao.tagName)==l||ao.tagName==""){ao.tagName="span"}ao.tAttr="style";ao.tVal=ao.styleName+":"+ao.styleValue+";"+aq;return al.replaceSelectedStyle(ao)};al.constructor.prototype.replaceSelectedStyle=function(ar){var aG=ar.tagName,aB=ar.tAttr,aE=ar.tVal,ax=ar.styleName,aD=ar.styleValue,aw=ar.editor,aJ=ar.notCreateNewNode,ap=ar.attr2,aK=ar.attr2Value,av=ar.command,az=ar.createNewNodeAction,aP,aF=20,aO=50,ay=10,aA="";if(!aw){console.log("replaceSelectedStyle err, editor = "+aw);return aj}aA=aw.data(o.EndCheckClass);aP=aw.data(o.EditSignClass);if(typeof(aJ)==l){aJ=false}am=new Date().getTime();if((am-an)<aF){return aj}var aq=aw.data(o.HasRefreshClick),aC=aw.data(o.SignClassNum),aH=aw.find("."+aw.data(o.EditSignClass)+aC),at=E.trim(al.getSelectText(aw,true)).length,aL=ar.isSetLinkColor?true:false;if(!aL&&!aq&&aH.length>0&&(at>0||aJ||(E.browser.msie&&E.browser.version=="9.0"))){aH.css(ax,aD);if(typeof(ap)!=l&&ap!=""){aH.attr(ap,aK)}if(aw.data(o.HasRsChildStyle)<aO){aw.data(o.HasRsChildStyle,parseInt(aw.data(o.HasRsChildStyle))+1);aH.find("*").css(ax,"");if(ax=="color"||ap=="color"){T.getEventCtrl().removeElementProp({element:aH,attrName:"color"})}if(aw.data(o.HasRsChildStyle)<ay){T.getEventCtrl().changeParentStyle({element:aH,styleName:ax,styleValue:aD,endCheckClass:aA})}}al.setOrUnsetUnderline({command:av,element:aH,editor:aw,endCheckClass:aA});return aj}an=am;aw.data(o.HasRefreshClick,false);aw.data(o.HasRsChildStyle,0);if(az==true){return aj}var aI=al.getWindowSelection(),aN,au,ao,aM;if(aI.anchorNode&&aI.getRangeAt){aN=aI.getRangeAt(0);au=e.createElement(aG);if(aH.length>0){if(aH.html()=="&nbsp;"){aH.replaceWith("")}else{aH.removeClass(aP+aC)}}aM=aw.attr("style");aw.height(aw.height()+"px");aC=parseInt(aC)+1;aw.data(o.SignClassNum,aC);E(au).addClass(aP+aC);ao=aN.extractContents();au.appendChild(ao);aw.attr("style",aM);if(typeof(ap)!=l&&ap!=""){E(au).attr(ap,aK)}aN.insertNode(au);if(aL){if(E(au).parent().attr("color")){E(au).attr("style","")}else{E(au).attr("style","").css(ax,aD)}}else{E(au).attr("style","").css(ax,aD)}if(av!=BtnCommand.Underline){if(aB=="style"){al.affectStyleAround(E(au),aE)}else{al.affectStyleAround(E(au),true)}}al.setOrUnsetUnderline({command:av,element:E(au),editor:aw,endCheckClass:aA})}};al.constructor.prototype.setOrUnsetUnderline=function(au){var av=au.command,at=au.element,aw=au.editor,az=au.endCheckClass,aG;if(av!=BtnCommand.Underline){return}var aq=false,aC=false,ax=false,aD=false,ar=false,aF,aA="none",aE="underline",ay="text-decoration";elemenText=E.trim(at.text());aG=aw.attr("style");aw.height(aw.height()+"px");aq=T.getEventCtrl().findTagInParent(at,"u",az);if(aq==false){aC=T.getEventCtrl().findTagInParent(at,"a",az);if(aC!=false&&aC.css(ay)!=aA){ax=aC;aC=true}else{aC=false}if(aC==false){var ao=at.find("u");if(ao.length>0&&E.trim(ao.eq(0).text())==elemenText){aD=true}if(aD==false){var ap=at.find("a");if(ap.length>0&&E.trim(ap.eq(0).text())==elemenText&&ap.eq(0).css(ay)!=aA){ar=true}else{ar=false}}}}al.setSelection(av);aF={element:at,effectElement:"a",styleName:ay,styleValue:aA,elemenText:elemenText,endCheckClass:az};if(aq!=false||aC!=false||aD!=false||ar!=false){if(aC==true&&E.trim(ax.text())!=elemenText){ax.find("*").css(ay,"");if(ax.css(ay)!=aA){ax.css(ay,aA)}else{ax.css(ay,aE)}}else{T.getEventCtrl().setElementStyleEffectAll(aF)}}else{var aB=E("<u></u>");aB.html(at.html());at.html(aB.prop("outerHTML"));T.getEventCtrl().setElementStyleEffectAll(aF)}al.setNodeRange(at[0]);aw.attr("style",aG);return aj};al.constructor.prototype.popCursorLastDiv=function(aq){var au=aq.obj,ar=aq.editor,ap=aq.checkOnfocused;if(ap&&ar.data(o.Onfocused)){return}try{if(!V){var ao=P.getSelection();if(ao.selectAllChildren&&au[0]&&!f.isIE9()){ao.selectAllChildren(au[0]);ao.collapseToEnd()}return}if(e.selection){var ao=e.selection.createRange();ao.moveToElementText(au[0]);ao.collapse(false);ao.select()}}catch(at){}}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){};return ah=new ak()}};h=new G();var q=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var al=this;ae.extend(this,h.getEventCtrl());al.constructor.prototype.setSelection=function(){console.log("rewrite setSelection");return aj}};return ai=new ak()};this.getUICtrl=function(){}};H=new q();var m=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(al){var am=this;am.constructor.prototype.bindInputEvent=function(au){var aq=au.element,an=au.module,at=au.editor,ap=au.command,ao=au.btn,ar=au.option,av=12,aw=120;ao.find(".selectDivCover").unbind("mousewheel.selectDivCover").bind("mousewheel.selectDivCover",function(ax,aB){if(ao.find(".fkEditor-formatBar").height()<=10){return false}var az=ao.find(".selectDiv span"),ay=parseInt(az.attr("_value")),aA;if(aB>0){if(ay>=aw){return false}ay=ay+1}else{if(ay<=av){return false}ay=ay-1}az.attr("_value",ay).text(ay);switch(ap){case BtnCommand.FontSize:if(!!ar.btnModuleEdit){aA={};aA.command=BtnCommand.FontSize;aA.val=ay+"px";_EditBtnBase.getEventCtrl().selectChangeForBtnModuel(au,aA)}else{h.getEventCtrl().setTagStyle({styleName:"font-size",styleValue:ay+"px",editor:at,notCreateNewNode:true,createNewNodeAction:true})}break;case BtnCommand.LineHeight:h.getEventCtrl().setTagStyle({styleName:"line-height",styleValue:ay+"px",editor:at,notCreateNewNode:true,createNewNodeAction:true});break;default:break}h.getEventCtrl().popCursorLastDiv({obj:aq});return false});aq.unbind("keyup").bind("keyup",function(ay){ay.stopPropagation();var ax=E(this),az=ax.html().replace(/\D/g,"");if(az>aw){az=aw;ax.html(az);if(ax.attr(N.Contenteditable)){h.getEventCtrl().popCursorLastDiv({obj:ax})}}else{if(az<av){az=av}}az=E.trim(az);ao.find(".selectDiv span").attr("_value",az);switch(ap){case BtnCommand.FontSize:if(!!ar.btnModuleEdit){otherOption={};otherOption.command=BtnCommand.FontSize;otherOption.val=az+"px";_EditBtnBase.getEventCtrl().selectChangeForBtnModuel(au,otherOption)}else{if(at.data(o.SelectedInputBlur)){_EditToolBase.getEventCtrl().editToolLogDog({module:an,command:BtnCommand.InputFontSize})}h.getEventCtrl().setTagStyle({styleName:"font-size",styleValue:az+"px",editor:at,notCreateNewNode:true,createNewNodeAction:true})}break;case BtnCommand.LineHeight:if(at.data(o.SelectedInputBlur)){_EditToolBase.getEventCtrl().editToolLogDog({module:an,command:BtnCommand.InputLineHeight})}h.getEventCtrl().setTagStyle({styleName:"line-height",styleValue:az+"px",editor:at,notCreateNewNode:true,createNewNodeAction:true});break;default:break}at.data(o.SelectedInputBlur,false)}).unbind("keydown").bind("keydown",function(ay){ay.stopPropagation();var ax=ay.keyCode;if(ax==13||ax==116){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ar)}if(!h.getEventCtrl().isNumberPress(ax)){ay.preventDefault();return}var az=E(this).html().replace(/\D/g,"");if(az=="0"&&(ax==48||ax==96)){ay.preventDefault();return}if(az.length>3){ay.preventDefault()}}).unbind("blur").bind("blur",function(ax){ax.stopPropagation();at.data(o.SelectedInputBlur,true)})};am.constructor.prototype.getWheelData=function(at){var aw=at.find(".fkEditor-formats"),aq=aw.find(".fkEditor-formatContent"),aE=aw.find(".fkEditor-formatSlider"),ao=aq.find(".fkEditor-format"),ay=aw.height(),aA=aq.height(),av=aE.height(),ax=ao.length,au=ao.height(),aC=ax-ay/au,aF=aA-ay,az=ay-av,ap=az/aC,aB=aF/aC,ar=aq.position().top,aD=aE.position().top,an=1;return{c:aq,s:aE,ct:ar,st:aD,cs:aB*an,ss:ap*an,cm:aF,sm:az}};am.constructor.prototype.bindMousewheelEvent=function(an){an.unbind("mousewheel.formatbar").bind("mousewheel.formatbar",function(ao,aq){var ap=this;if(!ap.c){E.extend(ap,am.getWheelData(an))}if(aq>0){ap.ct+=ap.cs;ap.st-=ap.ss}else{ap.ct-=ap.cs;ap.st+=ap.ss}if(ap.ct>0){ap.ct=0}else{if(ap.ct<-ap.cm){ap.ct=-ap.cm}}if(ap.st<0){ap.st=0}else{if(ap.st>ap.sm){ap.st=ap.sm}}ap.c.css({top:ap.ct});ap.s.css({top:ap.st});return false})}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createSelectedToolCoverDom=function(am){var an=[];an.push("<div "+C+' class="selectDivCover"></div>');return an};al.constructor.prototype.createSelectedToolDom=function(an){var ar=an.option,aq=an.btn,am=an.reSetUnselectable,ap=[],at=aq.command,ao=C;if(am){ao=am}ap.push("<div "+ao+' class="selectDiv selectDivNew">');ap.push("<span "+ao+"></span>");ap.push("</div>");ap.push("<a "+ao+' class="fkEditor-tool-icon fkEditor-tool-iconNew '+at+'-tool-icon">');ap.push("</a>");if(ao!=C){ap.push(al.createSelectedToolCoverDom(an).join(""))}return ap};al.constructor.prototype.createSelectedSlideToolDom=function(an){var aq=an.option,ap=an.btn,ao=[],am=[],au="formatDef",at=an.selectedData;am.push(al.createSelectedToolDom(an).join(""));am.push('<div class="'+aq.css+"-formatBar "+aq.css+'-formatBarNew"'+C+">");am.push('<div class="'+aq.css+"-formats "+aq.css+'-formatsNew fkEditorBar" '+C+">");am.push('<div class="'+aq.css+'-formatContent" '+C+">");for(var ar=0;ar<at.length;ar++){if(ar!=0){au=""}am.push("<a "+aq.css+'-formatval="'+at[ar][0]+'" '+aq.css+'-formatName="'+at[ar][1]+'" class="'+aq.css+"-format  "+aq.css+"-formatNew  "+au+'" role="menuitem" '+C+' title="'+at[ar][1]+'">');if(typeof(at[ar][2])!=l){am.push('<span class="'+at[ar][2]+'"></span>')}am.push('<span style="font-family:'+at[ar][0]+'" class="formatMg" '+C+">"+at[ar][1]);am.push("</span>");am.push("</a>")}am.push("</div>");am.push('<div class="'+aq.css+'-formatSlidebg"></div>');am.push('<div class="'+aq.css+'-formatSlider"></div>');am.push("</div>");am.push("</div>");return _EditBtnBase.getUICtrl().createBtnToolDom({option:aq,reSetUnselectable:an.reSetUnselectable,btn:ap,toolContent:am.join("")})}};return ah=new ak()}};_SelectedTool=new m();var X=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var ao=this,al=[],am=[],aq,ap,an,ar=false;ao.constructor.prototype.addBtnParam=function(av,aA,aw,at,au,ay,ax,az){return al.push({moduleName:av,command:aA,key:aw,tag:at,cls:au,emphasis:ay,className:ax,title:az})};ao.constructor.prototype.getButtonsData=function(at){var au=at.option;if(al&&al.length>0){return ao.getShowOrderBtn({btns:al,toolBtnOrder:au.Tool.ToolBtnOrder,option:au})}ao.addBtnParam("EditColorBtn",BtnCommand.Colors,"","","tool-colors",false,"tool-color","颜色");ao.addBtnParam("EditFormatsBtn",BtnCommand.Formats,"","","tool-formats",false,"","文字字体");ao.addBtnParam("EditFontSizeBtn",BtnCommand.FontSize,"","","tool-fontSize",false,"tool-size","文字大小");ao.addBtnParam("EditBreakLineBtn");ao.addBtnParam("EditBoldBtn",BtnCommand.Bold,"B",["b","strong","h1","h2","h3","h4","h5","h6"],"tool-bold tool-boldNew",true,"","加粗");ao.addBtnParam("EditItalicBtn",BtnCommand.Italic,"I",["i","em"],"tool-italic",true,"","斜体");ao.addBtnParam("EditUnderlineBtn",BtnCommand.Underline,"U",["u"],"tool-underline",true,"","下划线");ao.addBtnParam("EditWritingModeBtn",BtnCommand.WritingMode,"","","tool-writingMode tool-writingModeNew",false,"","文字排列方式");ao.addBtnParam("EditLineHeightBtn",BtnCommand.LineHeight,"","","tool-lineHeight",false,"","行高");ao.addBtnParam("EditTextAlignBtn",BtnCommand.TextAlign,"","","tool-textAlign",false,"","对齐方式");ao.addBtnParam("EditLinkBtn",BtnCommand.Linkcreator,"L",["a"],"tool-linkcreator",false,"","设置链接");ao.addBtnParam("EditRemoveFormatBtn",BtnCommand.Removeformat,".","","tool-removeformat",false,"","清除格式");ao.addBtnParam("EditSeperatorBtn");return ao.getShowOrderBtn({btns:al,toolBtnOrder:au.Tool.ToolBtnOrder,option:au})};ao.constructor.prototype.addHoverBtnParam=function(at,aw,au,av){return am.push({moduleName:at,command:aw,className:au,title:av})};ao.constructor.prototype.getHoverShowButtons=function(at){var au=at.option;if(am&&am.length>0){return ao.getShowOrderBtn({btns:am,toolBtnOrder:au.HoverTool.ToolBtnOrder,option:au})}ao.addHoverBtnParam("EditContentBtn",BtnCommand.EditContent,"tool-editContent tool-editContentNew","编辑文本");ao.addHoverBtnParam("EditFixedPositionBtn",BtnCommand.EditPositionFixed,"tool-editPositionFixed","固定");ao.addHoverBtnParam("EditLogoDisplayBtn",BtnCommand.EditLogoDisplay,"tool-editLogoDisplay","显示Logo");ao.addHoverBtnParam("EditBtnModuleStyleBtn",BtnCommand.BtnModuleStyle,"tool-editModule f-tool-editModule","设置样式");ao.addHoverBtnParam("EditAnimationBtn",BtnCommand.Animation,"f-tool-animation tool-animation tool-animationNew","模块动画");ao.addHoverBtnParam("EditOpacityBtn",BtnCommand.Opacity,"f-tool-opacity tool-opacity","透明度");ao.addHoverBtnParam("EditBorderBtn",BtnCommand.Border,"f-tool-border tool-border","边框");ao.addHoverBtnParam("EditShadowBtn",BtnCommand.Shadow,"f-tool-shadow tool-shadow","阴影");ao.addHoverBtnParam("EditGlobalLinkBtn",BtnCommand.GlobalLink,"f-tool-link tool-link tool-linkNew","设置链接");ao.addHoverBtnParam("EditDeleteBtn",BtnCommand.Delete,"f-tool-delete tool-delete tool-deleteNew","隐藏模块");ao.addHoverBtnParam("EditSeperatorBtn");return ao.getShowOrderBtn({btns:am,toolBtnOrder:au.HoverTool.ToolBtnOrder,option:au})};ao.constructor.prototype.getShowOrderBtn=function(au){var aw=au.option,ax=au.btns,az=au.toolBtnOrder,ay=[];for(var av=0;av<az.length;av++){for(var at=0;at<ax.length;at++){if(ax[at]["moduleName"]==az[av]){if(ax[at]["moduleName"]=="EditContentBtn"){ax[at]["title"]=aw.EditContentBtn.name}ay.push(ax[at]);break}}}return ay};ao.constructor.prototype.buttonEmphasize=function(av){var aJ=av.option,aP=av.buttons,aC=av.editor,aI=E("#"+aJ.css+"-toolBar-"+aJ.moduleId),aG=aI.find(".tool-formats"),aH=aI.find(".tool-fontSize"),az=aH.find(".selectDiv span"),aS=aI.find(".tool-lineHeight"),aK=aI.find(".tool-color ."+aJ.css+"-tool-icon"),aR=aJ.css+"-tool-depressedNew",aD=aJ.css+"-tool-depressedNewHover",aF=aJ.css+"-tool-depressedNewShow",aB='<div class="'+aR+'"></div>',ax,aM,aA;for(var aL=0;aL<aP.length;aL++){if(!T.getEventCtrl().checkInArray(aJ.Tool["ToolBtnOrder"],aP[aL].moduleName)){continue}aA=aP[aL].command;if(aP[aL].emphasis&&aP[aL].tag!=""){ax=aP[aL].cls.split(" ")[0];aM=h.getEventCtrl().detectElement({tags:aP[aL].tag});if(!aM){switch(aA){case BtnCommand.Bold:if("bold"==h.getEventCtrl().detectElementCss("font-weight")){aM=true}break;case BtnCommand.Italic:if("italic"==h.getEventCtrl().detectElementCss("font-style")){aM=true}break;case BtnCommand.Underline:if(/underline/.test(h.getEventCtrl().detectElementCss("text-decoration"))){aM=true}break;default:break}}if(aM){if(aI.find("."+ax).find("."+aF).length<=0){aI.find("."+ax).find("."+aR).addClass(aF).removeClass(aD)}}else{aI.find("."+ax).find("."+aR).removeClass(aF).addClass(aD)}}if(aA==BtnCommand.TextAlign){var aN=h.getEventCtrl().detectElementCss("text-align");switch(aN){case"center":_EditTextAlignBtn.getEventCtrl().textAlignEmphasize({editor:aC,toolbar:aI,command:BtnCommand.JustifyCenter});break;case"right":_EditTextAlignBtn.getEventCtrl().textAlignEmphasize({editor:aC,toolbar:aI,command:BtnCommand.JustifyRight});break;default:_EditTextAlignBtn.getEventCtrl().textAlignEmphasize({editor:aC,toolbar:aI,command:BtnCommand.JustifyLeft});break}}if(aA==BtnCommand.Colors){var at,aT="color";at=h.getEventCtrl().detectElementCss(aT);if(_EditColorBtn.getEventCtrl().checkColorIsWhite(at)){aK.css("border","solid 1px #ccc")}else{aK.css("border","0px")}aK.css("background",at);aK.removeClass("fk-colorPicker-transparentIco")}if(aA==BtnCommand.Formats){var aQ,aT="font-family",au=aJ.EditFormatsBtn.selectedData,ay=false,aE;if(au&&au.length>0){aQ=h.getEventCtrl().detectElementCss(aT);for(var aO=0;aO<au.length;aO++){if(E.trim(au[aO][0]).indexOf(E.trim(aQ))>=0){ay=true;aG.find(".selectDiv span").html(au[aO][1]);aE=aG.find("."+aJ.css+"-formatContent");aE.find(".formatDef").removeClass("formatDef");aE.find("a").eq(aO).addClass("formatDef");break}}if(!ay){if(aQ.indexOf(",")>0){aQ=aQ.substring(0,aQ.indexOf(","))}aG.find(".selectDiv span").html(aQ)}}}if(aA==BtnCommand.FontSize){var aT="font-size";fontSize=h.getEventCtrl().detectElementCss(aT);fontSize=parseInt(fontSize.replace("px",""));if(fontSize>0){if(az.attr(N.Contenteditable)=="true"){aH.find(".selectDiv span").attr("_value",fontSize).html(fontSize)}else{aH.find(".selectDiv span").attr("_value",fontSize).html(fontSize+"px")}}}if(aA==BtnCommand.LineHeight){var aw,aT="line-height";aw=h.getEventCtrl().detectElementCss(aT);aw=aw.replace("px","");if(isNaN(aw)&&fontSize){aw=fontSize}aw=parseInt(aw);if(aw>0){aS.find(".selectDiv span").attr("_value",aw)}}}};ao.constructor.prototype.bindToolBtnEvent=function(ax){var au=ax.option,aw=ax.editor,az=ax.toolbar,at=ax.module,av=ax.fkEditorWrap,aA=az.find(".simpleTextEditTool .tool"),ay=az.find(".editToolIcon"),aB="mouseup.hoverToolButton";if(z){ay.unbind(aB).bind(aB,function(aC){aC.stopPropagation()})}ay.unbind("click.hoverToolButton").bind("click.hoverToolButton",function(){ax.thisBtnElement=this;ao.hoverToolButtonClick(ax);return false});aA.unbind("click.toolbutton").bind("click.toolbutton",function(aD){aw.data(o.HasRsChildStyle,0);_EditColorBtn.getEventCtrl().backTextSelectedStatus(ax);E(".J_advanceColorPicker").hide();if(z){var aC=this;h.getEventCtrl().setSelectRange(aw.data(o.Range));ax.thisBtnElement=aC;!!au.btnModuleEdit?ao.toolButtonClickForBtnModuel(ax):ao.toolButtonClick(ax)}else{ax.thisBtnElement=this;!!au.btnModuleEdit?ao.toolButtonClickForBtnModuel(ax):ao.toolButtonClick(ax)}return false});return aj};ao.constructor.prototype.hoverToolButtonClick=function(aw){var aG=aw.option,aB=aw.editor,av=aw.module,aL=aw.fkEditorWrap,aF=aw.toolbar,ax=aw.thisBtnElement,aC=E(ax),at=aG.moduleId.replace("module",""),aA=aC.attr("command"),au=500,aH=aG.btnModuleEdit,ay=aG.tipTitle,aD,aJ=true,az=500;aB.data(o.PreCommand,aA);switch(aA){case BtnCommand.EditContent:if(aB.data(o.TriggerClick)){aB.data(o.TriggerClick,false);aJ=false}if(aB.find(".editTip").length>0){aB.data(o.PreHtmlContent,"")}else{aB.data(o.PreHtmlContent,aB.html())}aB.data(o.SimpleTextEdit,true);aB.data(o.HasRefreshClick,true);aB.removeData(o.Range,true);aF.css({width:aG.Tool.width,height:aG.Tool.height});aF.find(".simpleTextHoverTool").hide();aF.find(".simpleTextEditTool").fadeIn(au);aB.css("cursor","text");_EditLinkBtn.getEventCtrl().handTagANotJump(aB);av.addClass("formLockEdit");if(aB.not(":focus")){var aI=100;clearTimeout(an);an=setTimeout(function(){aB.find(".editTip").remove();aB.attr(N.Contenteditable,true).focus();_EditBtnBase.getEventCtrl().buttonEmphasize(aw)},aI)}_EditToolBase.getEventCtrl().calcuToolBarPos(aw);ag.checkSimpleTextHideTool(aG.moduleId);_EditToolBase.getEventCtrl().editToolBarMask(at);_EditWritingModeBtn.getEventCtrl().adjustWritingModeState(aw);if(!!aH){aD={};aD.command=BtnCommand.EditContent;_EditBtnBase.getEventCtrl().selectChangeForBtnModuel(aw,aD)}h.getEventCtrl().popCursorLastDiv({obj:aB,editor:aB,checkOnfocused:true});break;case BtnCommand.EditPositionFixed:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aG);_EditFixedPositionBtn.getEventCtrl().checkPositionFixed({toolbar:aF,btn:aC,option:aG});_EditToolBase.getEventCtrl().calcuToolBarPos(aw);break;case BtnCommand.EditLogoDisplay:if(ar){return}ar=true;_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aG);_EditLogoDisplayBtn.getEventCtrl().checkLogoDisplay({toolbar:aF,btn:aC,option:aG});setTimeout(function(){ar=false},az);break;case BtnCommand.GlobalLink:aB.data(o.PreHtmlContent,aB.html());_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aG);if(aB.find(".editTip").length>0&&!aH){f.ing("请输入内容",true);return}if(aG.globalJumpCtrlFun&&aG.globalJumpCtrlFun!=""){h.getEventCtrl().setNodeRange(aB[0]);var aK=h.getEventCtrl().getSelectText(aB,false),aE={};if(aG.editorName=="corpTitle"){aE=_EditLinkBtn.getEventCtrl().getCorpTitleLinkPreData()}else{aE=_EditLinkBtn.getEventCtrl().getGlobalLinkPreData(aB,aw)}if(!aH){if(aK&&aK!=""){if(aE._lide==""){aB.data(o.TriggerClick,true);aF.find(".tool-linkcreator").trigger("click");setTimeout(function(){aB.attr(N.Contenteditable,false)},500)}else{_EditGlobalLinkBtn.getEventCtrl().showGlobalLinkPanel(aw);f.fkEval(aG.globalJumpCtrlFun.replace("xxx",E.toJSON(aE)))}}}else{_EditGlobalLinkBtn.getEventCtrl().showGlobalLinkPanel(aw);f.fkEval(aG.globalJumpCtrlFun)}}break;case BtnCommand.Opacity:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aG);_EditOpacityBtn.getEventCtrl().showOpacityPanel(aw);break;case BtnCommand.Border:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aG);_EditBorderBtn.getEventCtrl().showBorderPanel(aw);break;case BtnCommand.Shadow:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aG);_EditShadowBtn.getEventCtrl().showShadowPanel(aw);break;case BtnCommand.Delete:_EditToolBase.getEventCtrl().deleteOrHideToolBar(aG);if(aG.deleteFun&&aG.deleteFun!=""){f.fkEval(aG.deleteFun)}else{aL.remove()}break;case BtnCommand.Animation:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aG);if(aG.animationFun&&aG.animationFun!=""){f.fkEval(aG.animationFun)}break;case BtnCommand.BtnModuleStyle:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aG);if(aG.editModuleFun&&aG.editModuleFun!=""){f.fkEval(aG.editModuleFun)}break;default:break}ay&&_EditToolBase.getEventCtrl().hideSimpleTip(aF.find(".simpleTextHoverTool .tool .editToolIcon"));aB.trigger("change");aJ&&_EditToolBase.getEventCtrl().editToolLogDog({module:av,command:aA})};ao.constructor.prototype.toolButtonClick=function(aE){var aB=aE.option,aD=aE.editor,aw=aE.module,aG=aE.toolbar,av=aE.thisBtnElement,aH=aG.find(".tool"),at=E(av),ay=at.attr("command"),aF=aG.find(".tool-color ."+aB.css+"-tool-icon"),aC=true;if(aD.not(":focus")){aD.attr(N.Contenteditable,true).focus()}if(ay==BtnCommand.Removeformat){aD.data(o.HasRefreshClick,true)}_EditorBase.getEventCtrl().setEidtorSelectedRule({editor:aD,command:ay});aD.data(o.PreCommand,ay);switch(ay){case BtnCommand.Linkcreator:if(aD.data(o.TriggerClick)){aD.data(o.TriggerClick,false);aC=false}_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aB);if(aB.jumpCtrlFun&&aB.jumpCtrlFun!=""&&!aD.data(o.LinkHasClick)){var aI=h.getEventCtrl().getSelectText(aD,true);linkPreData={};if(aB.editorName=="corpTitle"){linkPreData=_EditLinkBtn.getEventCtrl().getCorpTitleLinkPreData()}else{linkPreData=_EditLinkBtn.getEventCtrl().getLinkPreData()}aD.data(o.LinkHasClick,true);if(aI&&aI!=""){Z.fkEval(aB.jumpCtrlFun.replace("xxx",E.toJSON(linkPreData)))}clearTimeout(aq);aq=setTimeout(function(){aD.data(o.LinkHasClick,false)},2000)}break;case BtnCommand.Formats:_EditFormatsBtn.getEventCtrl().showFormatToolBar(aE);break;case BtnCommand.FontSize:_EditFontSizeBtn.getEventCtrl().showSizeToolBar(aE);break;case BtnCommand.LineHeight:_EditLineHeightBtn.getEventCtrl().showLineHiehgtToolBar(aE);break;case BtnCommand.Colors:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aB);var aI=h.getEventCtrl().getSelectText(aD,true);var au={moduleId:aB.moduleId.replace("module",""),target:aF,onShowStatus:ag.simpleTextColoronShowStatus,inputHexStatus:ag.simpleTextSetTextColor,onchange:ag.simpleTextSetTextColor,isSystemModule:aB.isSystemModule,_left:42};at.faiColorPickerAlp(au);if(ag.simpleTextList.allEditors){for(var aA=0;aA<ag.simpleTextList.allEditors.length;aA++){if(ag.simpleTextList.allEditors[aA]["moduleId"]==aB.moduleId){ag.simpleTextList.chooseEditor=ag.simpleTextList.allEditors[aA]["editor"];break}}}_EditColorBtn.getEventCtrl().simpleTextColorInputHexStatus({state:1,editor:aD,option:aB});break;case BtnCommand.Underline:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aB);if(E.trim(h.getEventCtrl().getSelectText(aD,true)).length>0&&aD.find("a").length>0){h.getEventCtrl().setTagStyle({editor:aD,command:ay})}else{h.getEventCtrl().setSelection(ay)}break;case BtnCommand.Removeformat:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aB);if(E.trim(h.getEventCtrl().getSelectText(aD,false)).length==E.trim(aD.text()).length){aD.html(aD.text())}else{var ax="20px",az=100;if(V){h.getEventCtrl().setTagStyle({styleName:"font-size",styleValue:ax,editor:aD})}h.getEventCtrl().setSelection(ay);h.getEventCtrl().setSelection("Unlink");clearTimeout(ap);ap=setTimeout(function(){h.getEventCtrl().setSelection("removeformat")},az);if(aw.find(".fk-editor-vertical-rl").length<1){_EditorBase.getEventCtrl().setEditorAutoHeight(aB.moduleId)}}break;case BtnCommand.TextAlign:_EditTextAlignBtn.getEventCtrl().showTextAlignBtnPanel(aE);break;case BtnCommand.WritingMode:_EditWritingModeBtn.getEventCtrl().switchWritingMode(aE);_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aB);ag.simpleTextSetCgData(aB.moduleId);break;default:h.getEventCtrl().setSelection(ay);_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aB);break}if(!aD.data(o.ClearSpanCursoring)){aD.trigger("change");aD.data(o.ClearSpanCursoring,true);aD.find("span").css("cursor","");setTimeout(function(){aD.data(o.ClearSpanCursoring,false)},300)}setTimeout(function(){if(ay==BtnCommand.Underline||ay==BtnCommand.Bold||ay==BtnCommand.Italic||ay==BtnCommand.Removeformat){_EditBtnBase.getEventCtrl().buttonEmphasize(aE)}if(E.trim(h.getEventCtrl().getSelectText(aD,true)).length>0){h.getEventCtrl().getSelectText(aD,false)}},100);aC&&_EditToolBase.getEventCtrl().editToolLogDog({module:aw,command:ay});return aj};ao.constructor.prototype.toolButtonClickForBtnModuel=function(aC){var ay=aC.option,aA=aC.editor,ax=aC.module,av=ay.moduleId,aE=av.replace("module",""),at,aD=aC.toolbar,aw=aC.thisBtnElement;toolbutton=aD.find(".tool"),jqThisBtn=E(aw),command=jqThisBtn.attr("command"),colorBar=aD.find(".tool-color ."+ay.css+"-tool-icon"),contentLink=f.top.Site.getModuleAttrPattern(aE).contentLink;h.getEventCtrl().setNodeRange(aA[0]);if(aA.not(":focus")){aA.attr(N.Contenteditable,true).focus()}aA.data(o.PreCommand,command);switch(command){case BtnCommand.Formats:_EditFormatsBtn.getEventCtrl().showFormatToolBar(aC);break;case BtnCommand.FontSize:_EditFontSizeBtn.getEventCtrl().showSizeToolBar(aC);break;case BtnCommand.Colors:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ay);function az(aG,aH){var aF=aH||aG;if(_EditColorBtn.getEventCtrl().checkColorIsWhite(aF)){colorBar.css("border","solid 1px #ccc")}else{colorBar.css("border","0px")}colorBar.css("background",aF);contentLink.y=1;contentLink.fct=1;contentLink.c=aF;f.top.Site.getModuleAttrPattern(aE).changed=true;ax.find(".lightModuleOuterContent"+aE).find("a").css("color",aF);ag.styleChanged()}function aB(aG,aF){if(aG==2){if(_EditColorBtn.getEventCtrl().checkColorIsWhite(aF)){colorBar.css("border","solid 1px #ccc")}else{colorBar.css("border","0px")}colorBar.css("background",aF);contentLink.y=1;contentLink.fct=1;contentLink.c=aF;f.top.Site.getModuleAttrPattern(aE).changed=true;ax.find(".lightModuleOuterContent"+aE).find("a").css("color",aF);ag.styleChanged()}}var au={moduleId:aE,target:colorBar,inputHexStatus:aB,onchange:az,_left:42,appendToWeb:true};jqThisBtn.faiColorPickerAlp(au);h.getEventCtrl().getWindowSelection().removeAllRanges();break;case BtnCommand.Underline:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ay);if(contentLink.d){contentLink.d=0;f.top.Site.getModuleAttrPattern(aE).changed=true;ag.setModuleStyleCssList(aE,[{cls:".lightModuleOuterContent"+aE+" a",key:"text-decoration",value:"none"},{cls:".lightModuleOuterContent"+aE+" .pagenation_N a span",key:"text-decoration",value:"none"}])}else{contentLink.y=1;contentLink.d=1;f.top.Site.getModuleAttrPattern(aE).changed=true;ag.setModuleStyleCssList(aE,[{cls:".lightModuleOuterContent"+aE+" a",key:"text-decoration",value:"underline"},{cls:".lightModuleOuterContent"+aE+" .pagenation_N a span",key:"text-decoration",value:"underline"}])}ag.styleChanged();break;case BtnCommand.Bold:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ay);if(contentLink.b){contentLink.b=0;f.top.Site.getModuleAttrPattern(aE).changed=true;ag.setModuleStyleCssList(aE,[{cls:".lightModuleOuterContent"+aE+" a",key:"font-weight",value:"normal"}])}else{contentLink.y=1;contentLink.b=1;f.top.Site.getModuleAttrPattern(aE).changed=true;ag.setModuleStyleCssList(aE,[{cls:".lightModuleOuterContent"+aE+" a",key:"font-weight",value:"bold"}])}ag.styleChanged();break;default:_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ay);break}if(!aA.data(o.ClearSpanCursoring)){aA.trigger("change");aA.data(o.ClearSpanCursoring,true);aA.find("span").css("cursor","");setTimeout(function(){aA.data(o.ClearSpanCursoring,false)},300)}setTimeout(function(){if(command==BtnCommand.Underline||command==BtnCommand.Bold){_EditBtnBase.getEventCtrl().buttonEmphasize(aC)}},100);_EditToolBase.getEventCtrl().editToolLogDog({module:ax,command:command});return aj};ao.constructor.prototype.selectChangeForBtnModuel=function(ay,at){var aw=ay.option,ax=ay.editor,au=ay.module,aB=aw.moduleId.replace("module",""),aA=f.top.Site.getModuleAttrPattern(aB).contentLink,av=at.command,az=at.val;switch(av){case BtnCommand.Formats:aA.y=1;aA.f=az;f.top.Site.getModuleAttrPattern(aB).changed=true;ax.css("font-family","'"+az+"'");ag.styleChanged();break;case BtnCommand.FontSize:ax.css("font-size",az);aA.y=1;aA.ls=az.replace("px","");f.top.Site.getModuleAttrPattern(aB).changed=true;ag.styleChanged();break;case BtnCommand.EditContent:au.find(".ui-resizable-handle").show();f.top.$(e).off("click.btnToolHide").on("click.btnToolHide",function(){if(!ax.attr(N.Contenteditable)){au.unbind("mouseout.showResizable")}});au.bind("mouseout.showResizable",function(){au.find(".ui-resizable-handle").show()});break}}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createHoverBtnToolDom=function(an){var ar=an.option,ap=an.btn,au=an.btnContent,ao=[],aq=ar.tipTitle,at="",am="";if(aq){am=' data-title-tip="'+ap.title+'" '}else{at=' title="'+ap.title+'" '}ao.push('<div command="'+ap.command+'" class="tool f-tool editTool '+ap.className+'" role="button" '+C+" "+at+" >");if(au){ao.push(au)}else{ao.push("<a "+C+' class="editToolIcon f-editToolIcon" command ="'+ap.command+'" '+am+" ></a>")}ao.push("</div>");return ao};al.constructor.prototype.createBtnToolDom=function(ao){var at=ao.option,ar=ao.btn,am=ao.toolContent,an=ao.reSetUnselectable,aq=[],ap=C;if(an){ap=an}aq.push('<div command="'+ar.command+'" class="tool '+ar.cls+" "+ar.className+'" role="button" data-tool="'+ar.cls+'" '+ap+' title="'+ar.title+'">');if(!am){aq.push("<a "+ap+' class="fkEditor-tool-icon"></a>')}else{aq.push(am)}if(typeof(ar.emphasis)!=l&&ar.emphasis){aq.push('<div class="'+at.css+"-tool-depressedNew "+at.css+'-tool-depressedNewHover"></div>')}aq.push("</div>");return aq}};return ah=new ak()}};_EditBtnBase=new X();var aa=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var an=this,aq,ar,al,am,ap,ao;an.constructor.prototype.bindToolAndEditorCreatedEvent=function(at){_EditGlobalLinkBtn.getEventCtrl().bindGlobalLinkPanelEvent(at);_EditOpacityBtn.getEventCtrl().bindOpacityPanelEvent(at);_EditBorderBtn.getEventCtrl().bindBorderPanelEvent(at);_EditShadowBtn.getEventCtrl().bindShadowPanelEvent(at);_EditFormatsBtn.getEventCtrl().bindFormatSliderEvent(at);_EditFontSizeBtn.getEventCtrl().bindFontSizeEvent(at);_EditLineHeightBtn.getEventCtrl().bindLineHeihgtSliderBarEvent(at);_EditTextAlignBtn.getEventCtrl().bindTextAlignSliderBarEvent(at);_EditRadiusBtn.getEventCtrl().bindRadiusBtnEvent(at);_EditBtnBase.getEventCtrl().bindToolBtnEvent(at);an.bindToolBarEvent(at);_FkEditor.getEventCtrl().bindEditorEvent(at);return aj};an.constructor.prototype.showToolBar=function(at){var aw=at.option,av=at.editor,au=at.module,ax=E("#fkEditor-toolBar-"+aw.moduleId);if(ag.checkNestModule(au).inSubNav&&!f.top._subNavPackEdit){return}an.calcuToolBarPos(at);an.calcuPanelPosForRight(at);au.data(o.HoverToolOn,true);if(!av.data(o.SimpleTextEdit)){an.checkEditItemDisplay(at);ax.find(".simpleTextEditTool").hide();ax.find(".simpleTextHoverTool").show()}};an.constructor.prototype.calcuToolBarPos=function(aC){var ax=aC.option,aB=aC.editor,aD=E("#fkEditor-toolBar-"+ax.moduleId),av=_EditorBase.getEventCtrl().getModule({option:ax}),au=E("#web").offset(),at=av.offset(),ay=at.top,aF=E("#g_main").width(),aw=at.left,aA=E(".floatLeftTop").offset().top,aG,aE,az=8;aD.css({left:0,top:0});ax.btnModuleEdit&&(az+=6);aG=aD.outerWidth();aE=aw+aG-aF;if(!(ax.HoverTool&&ax.HoverTool.show)){simpleTextEdit=true}if(aB.data(o.SimpleTextEdit)){toolBarHeight=parseInt(ax.Tool.height.replace("px",""))}else{toolBarHeight=parseInt(ax.HoverTool.height.replace("px",""))}aw=aw-au.left;aD.data(o.FixRight,false);if(aE>0){aw=aw-aE-20;aD.data(o.FixRight,true)}if(aw+aG+135>aF){aD.data(o.FixRight,true)}aw=aw<0?0:aw;aD.css({display:"block",top:(parseInt(ay-au.top)-(toolBarHeight+az))+"px",left:aw+"px"}).addClass("J_fkEditor_tool").data(o.ModuleId,ax.moduleId);if(au.top+aA>ay){aD.css({top:parseInt(ay+av.outerHeight()-aA)+"px"})}if(av.data("corpTitle")||av.data("logo")){if((f.top._logoPositionFixTop||f.top._titlePositionFixTop)&&ay<=aA){aD.css({top:parseInt(ay+av.outerHeight())+"px",position:"fixed"})}else{aD.css({position:"absolute"})}}return aj};an.constructor.prototype.calcuPanelPosForRight=function(aB){var ax=aB.option,az=aB.editor,aC=E("#fkEditor-toolBar-"+ax.moduleId),aw=aC.find(".simpleTextHoverTool .fkEditorBar"),aD=38,at,aE,aA,au,ay=2,av=-2;if(aC.data("fixRight")){aC.find(".tool .slideDiv").addClass("f-slideDiv-right");aw.each(function(){at=E(this).outerWidth();if(E(this).hasClass("borderPanel")){aA=_EditBorderBtn._panelHeight;ay=5;av=1}else{if(E(this).hasClass("opacityPanel")){aA=_EditOpacityBtn._panelHeight;ay=5;av=1}else{if(E(this).hasClass("linkPanel")){aA=_EditGlobalLinkBtn._panelHeight;ay=1;av=5}else{if(E(this).hasClass("shadowPanel")){aA=_EditShadowBtn._panelHeight;ay=5;av=1}}}}au=-aA;aE=-(at-aD);if(!isNaN(aA)&&aA>0){E(this).css({top:(au-ay)+"px",left:(aE-av)+"px"})}})}else{aw.css({left:"6px",top:"43px"});aC.find(".simpleTextHoverTool .linkPanel").css({left:"2px",top:"46px"});aC.find(".tool .slideDiv").removeClass("f-slideDiv-right")}};an.constructor.prototype.checkEditItemDisplay=function(au){var aw=au.option,ax=au.toolbar,av=ax.find(".tool-animation"),at,ay=aw.moduleId;if(typeof aw.animationStatusFun=="function"&&aw.animationStatusFun(ay.replace("module",""))==1){av.show();at=aw.HoverTool.animationShowWidth}else{av.hide();at=aw.HoverTool.width}ax.css("width",at);ax.css("height",aw.HoverTool.height);return aj};an.constructor.prototype.initModuleNameBtnInSidePos=function(ay){var ax=_EditorBase.getEventCtrl().getModule({option:ay}),aA=ax.parent().attr("id"),az=ax.attr("_side"),au=toolbar.find(".tool-edit-name"),aw,at,av;if(az==1){aw=au.offset().left;if(aA=="floatLeftTopForms"||aA=="floatLeftBottomForms"){av=-aw}else{if(aA=="floatRightTopForms"||aA=="floatRightBottomForms"){at=toolbar.offset().left;av=at-aw-33}}au.find(".J_moduleNamePanel").css("left",av+"px")}return aj};an.constructor.prototype.bindToolBarEvent=function(at){var aw=at.option,au=at.module,av=at.editor,ax=at.toolbar;ax.addClass("editorHoverShowTool").unbind("mouseover.hoverShowTool").bind("mouseover.hoverShowTool",function(ay){if(_EditorBase.getEventCtrl().checkEditorEditable(at)){au.data(o.HoverToolOn,true).trigger("mouseover");ax.css("display","block").addClass("J_fkEditor_tool").data(o.ModuleId,aw.moduleId)}clearTimeout(av.data(o.HoverToolTimeout));clearTimeout(av.data(o.EditLineTimeout));au.mouseenter()}).unbind("mouseenter.hoverShowTool").bind("mouseleave.hoverShowTool",function(ay){if(au.find(".fk-editor-vertical-rl").length<1){au.trigger("mouseleave")}au.data(o.HoverToolOn,false)}).off("click.hoverShowTool").on("click.hoverShowTool",function(ay){ay.stopPropagation()});ax.find(".simpleTextEditTool").not(".tool").off("click.notBtnClick").on("click.notBtnClick",function(){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aw);if(typeof(av.data(o.Range))!=l){h.getEventCtrl().setSelectRange(av.data(o.Range))}return false});if(ag.checkNestModule(au).inSubNav){ax.addClass("showInSubNavPack")}};an.constructor.prototype.deleteToolWrapDom=function(at){var aw=1000,av=at.deleteToolBar,au=at.option;if(!av){return aj}setTimeout(function(){var ax=av,ay=au;if(!ax.is(":visible")){E(e).unbind("mouseup.fkTool"+ay.moduleId);an.deleteOrHideToolBar(ay)}},aw);return aj};an.constructor.prototype.deleteOrHideToolBar=function(aw){var ax=E("#"+aw.css+"-toolBar-"+aw.moduleId),at=_EditorBase.getEventCtrl().getModule({option:aw}),av=at.find("."+aw.css),au;if(!!aw.btnModuleEdit){av=at.find("#"+aw.moduleId+"FlBtn")}if(typeof(ax)!=l){if(aw.isHideToolBar){ax.hide()}else{ax.remove()}if(!av.data(o.HasRemoveUselessChild)){au=av.attr("style");av.height(av.height()+"px");av.data(o.RemoveUselessChildIng,true);T.getEventCtrl().removeUselessChildStyle(av,av);av.data(o.RemoveUselessChildIng,false);setTimeout(function(){av.data(o.HasRemoveUselessChild,true)},500);av.attr("style",au)}}if(typeof(at)!=l){ag.setSimpleEditorBlur(at,av);if(P.getSelection){P.getSelection().removeAllRanges()}fkEditorLine=at.find(".fk-editor-line");if(fkEditorLine.hasClass("fk-editor-bd")){fkEditorLine.addClass("fk-editor-bdNone");fkEditorLine.removeClass("fk-editor-bd")}if(E.trim(av.text()).length<=0){if(aw.showEditTipWord){av.html('<div class="editTip">'+aw.editTipWord+"</div>")}else{av.html(aw.editTipWord)}}}};an.constructor.prototype.animateHideToolSecondPanel=function(aA,aC){var aF=E("#"+aA.css+"-toolBar-"+aA.moduleId),aH,aB,aG,av,az,aI,ay,au,ax,aE,aw,aD=200,at=20;if(aC!=BtnCommand.Opacity){aB=aF.find(".tool-opacity").find(".opacityPanel");if(aB.height()>0){aB.removeClass("f-opacityPanel-show");aF.find(".tool-opacity").find(".slideDiv").removeClass("slideDivBorder")}}if(aC!=BtnCommand.Border){aG=aF.find(".tool-border").find(".borderPanel");if(aG.height()>0){aG.removeClass("f-borderPanel-show");aF.find(".tool-border").find(".slideDiv").removeClass("slideDivBorder")}}if(aC!=BtnCommand.Shadow){av=aF.find(".tool-shadow").find(".shadowPanel");if(av.height()>0){av.removeClass("f-shadowPanel-show");aF.find(".tool-shadow").find(".slideDiv").removeClass("slideDivShadow")}}if(aC!=BtnCommand.GlobalLink){aH=aF.find(".tool-link").find("."+aA.css+"-linkSlideBar");if(aH.height()>0){aH.removeClass("linkPanelSlide");clearTimeout(ao);ao=setTimeout(function(){aF.find(".tool-link").find(".slideDiv").removeClass("slideDivBorder");aH.find(".fkEditorBar").removeClass("fkEditorBarBorder")},aD)}}if(aC!=BtnCommand.Formats){az=aF.find(".tool-formats").find("."+aA.css+"-formatBar");if(az.height()>0){clearTimeout(ar);az.removeClass("formatBarSlideDown");ar=setTimeout(function(){az.parent().find(".fkEditor-tool-iconNew").removeClass("edTriangleOnNew")},aD)}}if(aC!=BtnCommand.FontSize){aI=aF.find(".tool-fontSize").find("."+aA.css+"-formatBar");if(aI.height()>0){ay=aF.find(".tool-fontSize").find(".selectDiv");ay.find("span").attr(N.Contenteditable,false);aI.removeClass("formatBarSlideDown");clearTimeout(aq);aq=setTimeout(function(){ay.find("span").html(ay.find("span").attr("_value")+"px");aI.parent().find(".fkEditor-tool-iconNew").removeClass("edTriangleOnNew")},aD)}}if(aC!=BtnCommand.LineHeight){au=aF.find(".tool-lineHeight").find("."+aA.css+"-formatBar");if(au.height()>0){ax=aF.find(".tool-lineHeight").find(".selectDiv");ax.find("span").attr(N.Contenteditable,false);au.removeClass("formatBarSlideDown");clearTimeout(al);al=setTimeout(function(){ax.addClass("selectDivNew");ax.find("span").html("");au.parent().find(".fkEditor-tool-iconNew").removeClass("edTriangleOnNew")},aD)}}if(aC!=BtnCommand.TextAlign){aE=aF.find(".tool-textAlign").find("."+aA.css+"-formatBar");if(aE.height()>0){aw=aF.find(".tool-textAlign").find(".selectDiv");aE.removeClass("formatBarSlideDown textAlignSlideDown");clearTimeout(ap);ap=setTimeout(function(){aw.addClass("selectDivNew");aE.parent().find(".fkEditor-tool-iconNew").removeClass("edTriangleOnNew")},aD)}}if(E(".J_faiColorPickerAlp").is(":visible")){E(".J_faiColorPickerAlp").slideUp(aD)}return aj};an.constructor.prototype.isShowHoverToolPanel=function(au){var at=false;if(au.find(".tool-link").find(".fkEditor-linkSlideBar").height()>0){at=true}if(au.find(".tool-opacity").find(".opacityPanel").height()>0){at=true}if(au.find(".tool-border").find(".borderPanel").height()>0){at=true}if(au.find(".tool-shadow").find(".shadowPanel").height()>0){at=true}if(au.find(".setRadiusBar").data("radiusSliding")){at=true}return at};an.constructor.prototype.bindSliderInputEvent=function(at,av){var ax,aw,au;au=function(aA){var aE,aC,aD;aE={onChange:function(){},maxVal:100,per:"%",minVal:0,maxLength:3};aA=E.extend({},aE,aA);aC=function(){this.cache=[]};aC.prototype.add=function(aQ,aP,aN){var aL=this;for(var aM=0,aO;aO=aP[aM++];){(function(aS){var aR=aS.split(":");aL.cache.push(function(){var aT=aR.shift();aR.unshift(aQ);aR.push(aN);return aD[aT].apply(aQ,aR)})})(aO)}};aC.prototype.start=function(){for(var aL=0,aM;aM=this.cache[aL++];){var aN=aM();if(aN){return aN}}};aD={isNumberKey:function(aL,aM){if(!f.isNumberKey(aL._event)){return aM}},maxLength:function(aL,aN,aM){if(aL._length>=aN){return aM}},maxVal:function(aL,aN,aM){if(aL._value>aN){aH(aL,aN);h.getEventCtrl().popCursorLastDiv(aL);aL.focus();return aM}},minVal:function(aM,aL,aN){if(aM._value<aL){return aN}},isEditable:function(aL,aM){if(aL.hasClass("J_contentEditable contentEditable")){return aM}}};function aK(aL,aM){aM?aL.attr("contenteditable",aM).addClass("J_contentEditable contentEditable"):aL.removeAttr("contenteditable").removeClass("J_contentEditable contentEditable")}function aH(aL,aN,aM){aL.html(aN+(aM||""))}function aF(aL){return parseInt(aL.html().replace(aA.per,"")||0)||0}function aG(aL,aM){aL._value=aF(aL);aL._length=aL.html().length;aL._event=aM}function aI(aL,aO){var aM=new aC();aM.add(aL,["isEditable"],"可编辑状态中");var aN=aM.start();if(aN){return aN}aK(aL,true);aL.html(aF(aL));h.getEventCtrl().setNodeRange(aL[0]);if(f.isMozilla()){aL.focus()}}function aB(aL,aO){var aM=new aC();aG(aL,aO);aM.add(aL,["isNumberKey"],"请输入数字");aM.add(aL,["maxLength:"+aA.maxLength],"数字已达最大长度");var aN=aM.start();if(aN){return false}}function ay(aL,aO){var aM=new aC();aG(aL,aO);aM.add(aL,["maxVal:"+aA.maxVal],"超过最大值");var aN=aM.start();az(aL,aO);if(aN){return aN}}function az(aL,aO){var aM=new aC();aG(aL,aO);aM.add(aL,["minVal:"+aA.minVal],"小于最小值");var aN=aM.start();var aP=aF(aL);if(aN){aP=aA.minVal}aA.onChange(aP)}function aJ(aL,aO){var aM=new aC();aG(aL,aO);aM.add(aL,["minVal:"+aA.minVal],"小于最小值");var aN=aM.start();var aP=aF(aL);if(aN){aP=aA.minVal}aH(aL,aP,aA.per);aK(aL,false)}return{click:aI,keypress:aB,keyup:ay,blur:aJ}};ax=function(){var az=["click"," keypress"," keyup"," blur",""],ay=".sliderInput";at.off(ay).on(az.join(ay),function(aA){aA.stopPropagation();return au(av)[aA.type](E(this),aA)})};aw=function(){at.length&&ax();return at};return aw()};an.constructor.prototype.editToolBarMask=function(au){var at={id:au,useClass:true,leftClass:"fk-dialog-hidden-mask",rightClass:"fk-dialog-hidden-mask",topClass:"fk-dialog-hidden-mask",bottomClass:"fk-dialog-hidden-mask",centerClass:"fk-dialog-center-mask",extFn:[{name:"click.dialogmask",fn:function(){an.removeToolBarDialog(au)}}]};ag.addModuleMask(at);E("#g_main").off("mousewheel.disabledScroll").on("mousewheel.disabledScroll",function(av){setTimeout(function(){ag.addModuleMask(at)},200)})};an.constructor.prototype.removeToolBarDialog=function(au,at){ag.checkSimpleTextHideTool();if(E(".moduleMaskContainer").length>0){ag.removeModuleMask()}E("#g_main").off("mousewheel.disabledScroll")};an.constructor.prototype.hideHoverTool=function(at){var av=at.option,au=at.editor,aw=E("#fkEditor-toolBar-"+av.moduleId);if(au.data(o.SimpleTextEdit)){return}if(_EditToolBase.getEventCtrl().isShowHoverToolPanel(aw)){return}if(f.top.$(".popupBg").length<=0){_EditToolBase.getEventCtrl().deleteOrHideToolBar(av)}else{av.isHideToolBar=true;_EditToolBase.getEventCtrl().deleteOrHideToolBar(av);av.isHideToolBar=false}};an.constructor.prototype.buildSimpleTip=function(au,at){var av=au.toolbar;at.off("mouseenter.tips").on("mouseenter.tips",function(){var aw=E(this).attr("data-title-tip");if(!aw){return}if(av.find(".setRadiusBar").data("radiusSliding")){return}E(this).addClass("f-button-tip-vertical");if(ag.getTopHeight()+48>E(this).offset().top){E(this).removeClass("f-button-top").addClass("f-button-bottom")}else{E(this).addClass("f-button-top").removeClass("f-button-bottom")}}).off("mouseleave.tips").on("mouseleave.tips",function(){E(this).removeClass("f-button-tip-vertical").removeClass("f-button-bottom").removeClass("f-button-tip")})};an.constructor.prototype.hideSimpleTip=function(at){at.removeClass("f-button-tip-vertical").removeClass("f-button-bottom").removeClass("f-button-tip")};an.constructor.prototype.editToolLogDog=function(at){var au=at.module,av=at.command;if(au.hasClass("formStyle81")){switch(av){case BtnCommand.EditContent:ag.logDog(200193,1);break;case BtnCommand.BtnModuleStyle:ag.logDog(200193,2);break;case BtnCommand.Animation:ag.logDog(200193,3);break;case BtnCommand.GlobalLink:ag.logDog(200193,4);break;case BtnCommand.Opacity:ag.logDog(200193,5);break;case BtnCommand.Border:ag.logDog(200193,6);break;case BtnCommand.Shadow:ag.logDog(200193,7);break;case BtnCommand.Radius:ag.logDog(200193,8);break;case BtnCommand.Delete:ag.logDog(200193,9);break;case BtnCommand.Colors:ag.logDog(200193,10);break;case BtnCommand.Bold:ag.logDog(200193,11);break;case BtnCommand.Underline:ag.logDog(200193,12);break;case BtnCommand.Formats:ag.logDog(200193,13);break;case BtnCommand.FontSize:ag.logDog(200193,14);break;case BtnCommand.Dblclick:ag.logDog(200193,15);break;default:break}}else{if(au.hasClass("formStyle86")){switch(av){case BtnCommand.EditContent:ag.logDog(200077,1);break;case BtnCommand.Animation:ag.logDog(200077,2);break;case BtnCommand.GlobalLink:ag.logDog(200077,3);break;case BtnCommand.Delete:ag.logDog(200077,4);break;case BtnCommand.Colors:ag.logDog(200077,5);break;case BtnCommand.Bold:ag.logDog(200077,6);break;case BtnCommand.Italic:ag.logDog(200077,7);break;case BtnCommand.Underline:ag.logDog(200077,8);break;case BtnCommand.Formats:ag.logDog(200077,9);break;case BtnCommand.FontSize:ag.logDog(200077,10);break;case BtnCommand.WritingMode:ag.logDog(200077,13);break;case BtnCommand.LineHeight:ag.logDog(200077,14);break;case BtnCommand.TextAlign:ag.logDog(200077,17);break;case BtnCommand.JustifyLeft:ag.logDog(200077,18);break;case BtnCommand.JustifyCenter:ag.logDog(200077,19);break;case BtnCommand.JustifyRight:ag.logDog(200077,20);break;case BtnCommand.SingleClick:ag.logDog(200077,21);break;case BtnCommand.Dblclick:ag.logDog(200077,22);break;case BtnCommand.Linkcreator:ag.logDog(200077,23);break;case BtnCommand.DeleteLink:ag.logDog(200077,24);break;case BtnCommand.InputFontSize:ag.logDog(200077,25);break;case BtnCommand.InputLineHeight:ag.logDog(200077,26);break;case BtnCommand.ChooseFormats:ag.logDog(200077,27);break;case BtnCommand.ChooseLineHeight:ag.logDog(200077,28);break;default:break}}else{if(au.hasClass("corpTitle")){switch(av){case BtnCommand.EditContent:ag.logDog(200271,1);break;case BtnCommand.GlobalLink:ag.logDog(200271,2);break;case BtnCommand.EditPositionFixed:ag.logDog(200271,3);break;case BtnCommand.EditLogoDisplay:if(f.top.$("#logo").is(":visible")){ag.logDog(200271,4)}else{ag.logDog(200271,5)}break;case BtnCommand.Delete:ag.logDog(200271,6);break;case BtnCommand.Dblclick:ag.logDog(200271,7);break;case BtnCommand.Colors:ag.logDog(200271,8);break;case BtnCommand.Bold:ag.logDog(200271,9);break;case BtnCommand.Italic:ag.logDog(200271,10);break;case BtnCommand.Underline:ag.logDog(200271,11);break;case BtnCommand.Formats:ag.logDog(200271,12);break;case BtnCommand.LineHeight:ag.logDog(200271,13);break;case BtnCommand.TextAlign:ag.logDog(200271,14);break;default:break}}}}}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var am=this,al="J_fkSingleTool";am.constructor.prototype.creatButtonsList=function(at){var aq=at.option,au=at.buttons,av=at.toolbar,aw=av.find(".simpleTextEditTool"),ar=[],ao,an="moduleName";if(aw.children().length>0){return}for(var ap=0;ap<au.length;ap++){ao=au[ap];at.btn=ao;if(ao[an]=="EditColorBtn"){ar.push(_EditColorBtn.getUICtrl().createBtnToolDom(at).join(""))}if(ao[an]=="EditBoldBtn"){ar.push(_EditBoldBtn.getUICtrl().createBtnToolDom(at).join(""))}if(ao[an]=="EditItalicBtn"){ar.push(_EditItalicBtn.getUICtrl().createBtnToolDom(at).join(""))}if(ao[an]=="EditUnderlineBtn"){ar.push(_EditUnderlineBtn.getUICtrl().createBtnToolDom(at).join(""))}if(ao[an]=="EditFormatsBtn"){ar.push(_EditFormatsBtn.getUICtrl().createBtnToolDom(at).join(""))}if(ao[an]=="EditFontSizeBtn"){ar.push(_EditFontSizeBtn.getUICtrl().createBtnToolDom(at).join(""))}if(ao[an]=="EditWritingModeBtn"){ar.push(_EditWritingModeBtn.getUICtrl().createBtnToolDom(at).join(""))}if(ao[an]=="EditLineHeightBtn"){ar.push(_EditLineHeightBtn.getUICtrl().createBtnToolDom(at).join(""))}if(ao[an]=="EditTextAlignBtn"){ar.push(_EditTextAlignBtn.getUICtrl().createBtnToolDom(at).join(""))}if(ao[an]=="EditLinkBtn"){ar.push(_EditLinkBtn.getUICtrl().createBtnToolDom(at).join(""))}if(ao[an]=="EditRemoveFormatBtn"){ar.push(_EditRemoveFormatBtn.getUICtrl().createBtnToolDom(at).join(""))}if(ao[an]=="EditSeperatorBtn"){ar.push(_EditSeperatorBtn.getUICtrl().createHoverBtnToolDom().join(""))}if(ao[an]=="EditBreakLineBtn"){ar.push(_EditBreakLineBtn.getUICtrl().createHoverBtnToolDom().join(""))}_EditBreakLineBtn}aw.append(ar.join(""));return aj};am.constructor.prototype.creatHoverButtonsList=function(aw){var au=aw.option,ar=aw.hoverShowButtons,ay=aw.toolbar,ao=ay.find(".simpleTextHoverTool"),av=[],aq,an="moduleName",ax,ap=au.tipTitle;if(ao.children().length>0){return aj}for(var at=0;at<ar.length;at++){aq=ar[at];aw.btn=aq;if(aq[an]=="EditContentBtn"){av.push(_EditContentBtn.getUICtrl().createHoverBtnToolDom(aw).join(""))}if(aq[an]=="EditFixedPositionBtn"){av.push(_EditFixedPositionBtn.getUICtrl().createHoverBtnToolDom(aw).join(""))}if(aq[an]=="EditLogoDisplayBtn"){av.push(_EditLogoDisplayBtn.getUICtrl().createHoverBtnToolDom(aw).join(""))}if(aq[an]=="EditAnimationBtn"){av.push(_EditAnimationBtn.getUICtrl().createHoverBtnToolDom(aw).join(""))}if(aq[an]=="EditBtnModuleStyleBtn"){av.push(_EditBtnModuleStyleBtn.getUICtrl().createHoverBtnToolDom(aw).join(""))}if(aq[an]=="EditGlobalLinkBtn"){av.push(_EditGlobalLinkBtn.getUICtrl().createHoverBtnToolDom(aw).join(""))}if(aq[an]=="EditOpacityBtn"){av.push(_EditOpacityBtn.getUICtrl().createHoverBtnToolDom(aw).join(""))}if(aq[an]=="EditBorderBtn"){av.push(_EditBorderBtn.getUICtrl().createHoverBtnToolDom(aw).join(""))}if(aq[an]=="EditShadowBtn"){av.push(_EditShadowBtn.getUICtrl().createHoverBtnToolDom(aw).join(""))}if(aq[an]=="EditDeleteBtn"){av.push(_EditDeleteBtn.getUICtrl().createHoverBtnToolDom(aw).join(""))}if(aq[an]=="EditSeperatorBtn"){av.push(_EditSeperatorBtn.getUICtrl().createHoverBtnToolDom().join(""))}}ao.append(av.join(""));if(ap){ax=ao.find(".tool .editToolIcon");aj.getEventCtrl().buildSimpleTip(aw,ax)}return aj};am.constructor.prototype.buildToolWrapDom=function(ao){var at=ao.option,au,ar=ao.editor,an=[],av,au,aq=6;if(!at.moduleId||at.moduleId<=0){console.log("buildToolWrapDom moduleId err, option.moduleId = "+at.moduleId);return au}au=E("#"+at.css+"-toolBar-"+at.moduleId);av=E("."+al);for(var ap=0;ap<av.length;ap++){av=av.eq(ap);aj.getEventCtrl().deleteToolWrapDom({deleteToolbar:av,option:av.data(o.Option)})}at.btnModuleEdit&&(aq+=6);an.push('<div id="'+at.css+"-toolBar-"+at.moduleId+'" role="toolbar" class="'+al+" "+at.css+" "+at.toolExtClasses+" "+at.css+"-tool "+at.css+'DefHeight" style="width:'+at.toolBarWidth+'">');an.push('<div style="display:none;"><input maxlength="255" id="simpleTextLinkInputVal-'+at.moduleId+'"></input></div>');an.push('<div class="simpleTextHoverTool"></div>');an.push('<div class="simpleTextEditTool" style="display:none;"></div>');an.push('<div class="simpleTextCover f-simpleTextCover" style="height:'+aq+'px;"></div>');an.push("</div>");E("#web").append(an.join(""));au=E("#"+at.css+"-toolBar-"+at.moduleId);au.data(o.Option,at);return au}};return ah=new ak()}};_EditToolBase=new aa();var Q=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var am=this,ao,al,an;am.constructor.prototype.getModule=function(ap){var ar=ap.option,aq;if(ar.moduleId=="null"||ar.moduleId==0){return}aq=E("#"+ar.moduleId);return aq};am.constructor.prototype.stopBannerJump=function(aq){var ar=aq.clickEvent,ap=E(ar.target).parentsUntil("#bannerV2",".J_bannerItem");if(ap.length){href=ap.attr("href");target=ap.attr("target");ap.attr("href","javascript:void(0);").attr("target","");ar.stopPropagation();setTimeout(function(){ap.attr("href",href).attr("target",target)},0)}};am.constructor.prototype.logEditorSingleClick=function(ap){var ar=ap.editor,aq=ap.module;clearTimeout(an);an=setTimeout(function(){if(ar.attr(N.Contenteditable)!="true"){_EditToolBase.getEventCtrl().editToolLogDog({module:aq,command:BtnCommand.SingleClick})}},300)};am.constructor.prototype.setEidtorSelectedRule=function(aq){var ar=aq.editor,at=aq.command,ap=false;if(ar.text().length<=0){return}if(h.getEventCtrl().getSelectText(ar,true).length<=0){if(ar.data(o.HasRefreshClick)){h.getEventCtrl().setNodeRange(ar[0]);ap=true}else{if(at!=BtnCommand.Colors&&at!=BtnCommand.FontSize&&at!=BtnCommand.LineHeight){h.getEventCtrl().setSelectRange(ar.data(o.Range));ap=true}}}clearTimeout(al);al=setTimeout(function(){var au=ar.data(o.SignClassNum),aw=ar.find("."+ar.data(o.EditSignClass)+au);if(ar.data(o.HasRefreshClick)||aw.length<=0){var av=h.getEventCtrl().getSelectText(ar,true).length>0;ar.data(o.HasSelectText,av);if(av){h.getEventCtrl().setTagStyle({styleName:"xxxx",styleValue:"",editor:ar,notCreateNewNode:false})}}if(ap){h.getEventCtrl().getSelectText(ar,false)}},100)};am.constructor.prototype.bindAllEvent=function(aq){var av=aq.option,ar=aq.module,au=aq.editor,aw,ap=aq.fkEditorWrap,at="mouseup.fkTool"+av.moduleId;ar.unbind("mouseenter.fkModuleEvent").bind("mouseenter.fkModuleEvent",function(aB){if(ag.checkNestModule(ar).inSubNav&&!f.top._subNavPackEdit){return}clearTimeout(au.data(o.EditLineTimeout));var aA=E(this).find(".fk-editor-line"),az=E("#"+av.css+"-toolBar-"+av.moduleId),ay,ax;if(aA.hasClass("fk-editor-bdNone")){aA.addClass("fk-editor-bd");aA.removeClass("fk-editor-bdNone")}clearTimeout(au.data(o.HoverToolTimeout));aq.toolbar=az;if(az.length<1){ay=_EditBtnBase.getEventCtrl().getButtonsData(aq);aq.buttons=ay;ax=_EditBtnBase.getEventCtrl().getHoverShowButtons(aq);aq.hoverShowButtons=ax;az=_EditToolBase.getUICtrl().buildToolWrapDom(aq);aq.toolbar=az;if(av.EditRadiusBtn){_EditRadiusBtn.getUICtrl().createEditRadiusBtnDom(aq)}_EditToolBase.getUICtrl().creatHoverButtonsList(aq);_EditToolBase.getUICtrl().creatButtonsList(aq);T.getEventCtrl().setUnselectable(aq);_EditToolBase.getEventCtrl().bindToolAndEditorCreatedEvent(aq);_EditToolBase.getEventCtrl().showToolBar(aq)}if(!au.data(o.SimpleTextEdit)){_EditToolBase.getEventCtrl().checkEditItemDisplay(aq);az.find(".simpleTextEditTool").hide();az.find(".simpleTextHoverTool").show()}ag.createSimpleTextAutoWidthBtn(E(this))}).unbind("mouseleave.fkModuleEvent").bind("mouseleave.fkModuleEvent",function(ay){var ax=E(this).find(".fk-editor-line"),az=200;if(!am.checkEditorEditable(aq)){if(!au.data(o.SimpleTextEdit)){au.data(o.EditLineTimeout,setTimeout(function(){aq.fkEditorLine=ax;_EditorBase.getEventCtrl().hideEditLine(aq)},az))}}if(!au.data(o.SimpleTextEdit)){au.data(o.HoverToolTimeout,setTimeout(function(){_EditToolBase.getEventCtrl().hideHoverTool(aq)},az))}}).unbind("dblclick.fkModuleEvent").bind("dblclick.fkModuleEvent",function(ax){if(ag.checkNestModule(ar).inSubNav&&!f.top._subNavPackEdit){return}aw=E("#"+av.css+"-toolBar-"+av.moduleId);if(aw.find(".simpleTextHoverTool").is(":visible")){au.data(o.TriggerClick,true);aw.find(".tool-editContentNew .editToolIcon").trigger("click")}_EditToolBase.getEventCtrl().editToolLogDog({module:ar,command:BtnCommand.Dblclick})});if(z){E(e).unbind(at).bind(at,function(ax){if(ax.button!=0){return}if(ar.data(o.Mousemove)&&E(".fk-popupWindowVT").length<1){h.getEventCtrl().getSelectText(au,false)}})}};am.constructor.prototype.checkEditorEditable=function(ap){var ar=ap.editor,aq=ar.attr(N.Contenteditable);if(typeof(aq)==l||aq==false||aq=="false"){return false}return true};am.constructor.prototype.backTextSelected=function(ap){var aq=ap.data(o.SignClassNum),at=ap.find("."+ap.data(o.EditSignClass)+aq),ar=ap.data(o.HasRefreshClick);if(!ar){h.getEventCtrl().setNodeRange(at[0])}return aj};am.constructor.prototype.refeshEidtorHeight=function(aq){var av=aq.option,au=aq.editor,ar=aq.module;if(au.hasClass("fk-editor-vertical-rl")){return}var ap=au[0].clientHeight,at=au[0].scrollHeight;if(!au.data(o.PreScrollHeight)){au.data(o.PreScrollHeight,at)}if(au.data(o.ChangeCount)>av.changeCount&&(at>ap||at!=au.data(o.PreScrollHeight))&&!au.data(o.ScrollChangeChecking)){au.data(o.PreScrollHeight,at);au.data(o.ScrollChangeChecking,true);au.css("height",at+"px");ar.css("height",at+"px");ar.attr("_autoheight",0);ar.trigger("mouseover");setTimeout(function(){au.data(o.ScrollChangeChecking,false)},50)}am.setEditorAutoHeight(ar.attr("id"))};am.constructor.prototype.setEditorAutoHeight=function(aq){if(E("#fkEditor-"+aq).length>0&&E("#fkEditor-"+aq).hasClass("fk-editor-vertical-rl")){return}clearTimeout(ao);var ap=200;ao=setTimeout(function(){ag.autoModuleHeight(aq.replace("module",""))},ap);return aj};am.constructor.prototype.hideEditLine=function(ap){var ar=ap.option,aq=ap.editor,au=ap.fkEditorLine,at=E("#fkEditor-toolBar-"+ar.moduleId);if(aq.data(o.SimpleTextEdit)){return}if(at.find(".tool-link").find(".linkPanel").height()>0){return}if(au.hasClass("fk-editor-bd")){au.addClass("fk-editor-bdNone");au.removeClass("fk-editor-bd")}};am.constructor.prototype.simpleTextFormatPasteData=function(aq,ap){T.getEventCtrl().filterPasteData(aq);T.getEventCtrl().textPositionCorrect(aq)}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this};return ah=new ak()}};_EditorBase=new Q();var k=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createHoverBtnToolDom=function(){var am=[];am.push('<div class="seperatorNew"></div>');return am}};return ah=new ak()}};_EditSeperatorBtn=new k();var x=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createHoverBtnToolDom=function(){var am=[];am.push('<div style="clear:both;"></div>');return am}};return ah=new ak()}};_EditBreakLineBtn=new x();var S=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createHoverBtnToolDom=function(am){return _EditBtnBase.getUICtrl().createHoverBtnToolDom(am)}};return ah=new ak()}};_EditAnimationBtn=new S();var W=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createHoverBtnToolDom=function(am){var ao=am.btn,an;am.btnContent="<a "+C+' class="editToolIcon f-editToolIcon" command ="'+ao.command+'">'+ao.title+"</a>";an=_EditBtnBase.getUICtrl().createHoverBtnToolDom(am);am.btnContent=null;return an}};return ah=new ak()}};_EditBtnModuleStyleBtn=new W();var af=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createBtnToolDom=function(am){return _EditBtnBase.getUICtrl().createBtnToolDom(am)}};return ah=new ak()}};_EditBoldBtn=new af();var O=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createHoverBtnToolDom=function(am){var ao=am.btn,an,ap=am.option;if(ap.btnModuleEdit){am.btnContent=""}else{am.btnContent="<a "+C+' class="editToolIcon" command ="'+ao.command+'">'+ao.title+"</a>"}an=_EditBtnBase.getUICtrl().createHoverBtnToolDom(am);am.btnContent=null;return an}};return ah=new ak()}};_EditContentBtn=new O();var ad=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(al){var am=this;am.constructor.prototype.checkPositionFixed=function(an){var ao=an.btn,ap=an.option;if(typeof(ap.positionFixedFun)=="function"){var aq=am.setFixedPositionBtnTitle(an);ap.positionFixedFun()}};am.constructor.prototype.setFixedPositionBtnTitle=function(ao){var ap=ao.btn,ar=ao.option,at=ao.toolbar,aq=ar.tipTitle,au="",an="editToolIconUnable";if(f.top._titlePositionFixTop){ap.removeClass(an);au="固定"}else{ap.addClass(an);au="不固定"}if(aq){ap.attr("data-title-tip",au)}else{ap.attr("title",au)}}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createHoverBtnToolDom=function(an){var ap,ao=an.btn,am="",ar=an.option,aq=ar.tipTitle;editToolIconUnable=f.top._titlePositionFixTop?"editToolIconUnable":"";ao.title=f.top._titlePositionFixTop?"不固定":"固定";if(aq){am=' data-title-tip="'+ao.title+'" '}else{am=' title="'+ao.title+'" '}an.btnContent="<a "+C+' class="editToolIcon '+editToolIconUnable+'" command ="'+ao.command+'" '+am+"></a>";ap=_EditBtnBase.getUICtrl().createHoverBtnToolDom(an);an.btnContent=null;return ap}};return ah=new ak()}};_EditFixedPositionBtn=new ad();var w=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(al){var am=this;am.constructor.prototype.checkLogoDisplay=function(ao){var ap=ao.btn,aq=ao.option;if(typeof(aq.logoDisplayFun)=="function"){var an=am.setLogoDisplayBtnTitle(ao);aq.logoDisplayFun(an)}};am.constructor.prototype.setLogoDisplayBtnTitle=function(ap){var aq=ap.btn,at=ap.option,av="",au=ap.toolbar,ar=at.tipTitle,an="editToolIconUnable",ao=f.top.$("#logo").is(":visible")?true:false;if(ao){aq.addClass(an);av="显示Logo"}else{aq.removeClass(an);av="隐藏Logo"}if(ar){aq.attr("data-title-tip",av)}else{aq.attr("title",av)}return ao}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createHoverBtnToolDom=function(ao){var aq,ap=ao.btn,at=ao.option,ar=at.tipTitle,an="",am=f.top.$("#logo").is(":visible")?true:false,au=am?"":"editToolIconUnable";ap.title=am?"隐藏Logo":"显示Logo";if(ar){an=' data-title-tip="'+ap.title+'" '}else{an=' title="'+ap.title+'" '}ao.btnContent="<a "+C+' class="editToolIcon '+au+'" command ="'+ap.command+'" '+an+"></a>";aq=_EditBtnBase.getUICtrl().createHoverBtnToolDom(ao);ao.btnContent=null;return aq}};return ah=new ak()}};_EditLogoDisplayBtn=new w();var c=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var ao=this,am=false,al,an,ap;ao.constructor.prototype.checkColorIsWhite=function(aq){var at=false;if(typeof(aq)==l||aq=="null"||E.trim(aq).length<=0){return at}aq=E.trim(aq);aq=aq.toLowerCase();if(aq.indexOf(";")>0){aq=aq.split(";");aq=aq[0]}if(aq.indexOf("white")!=-1||aq.indexOf("#ffffff")!=-1){return at=true}if(aq.indexOf("rgb")!=-1){if(aq.indexOf("(255, 255, 255)")!=-1){return at=true}var ar=aq.split(",");if(ar.length>3&&(aq.indexOf(", 0)")!=-1||aq.indexOf(",0)")!=-1)){return at=true}}return at};ao.constructor.prototype.simpleTextColorInputHexStatus=function(aC){var aB=aC.editor,az=aC.option,ar=aC.state,ax=aC.color,aD=aC.rgbaColor,aw=false,aA=false,av,au,at,ay,av=h.getEventCtrl().getSelectedNode();if(aB.data(o.HasRefreshClick)&&ar==1){if(E.trim(h.getEventCtrl().getSelectText(aB,true)).length<=0){aB.data(o.NotCreateNewNode,false)}else{aB.data(o.NotCreateNewNode,true)}}aw=aB.data(o.NotCreateNewNode);if(typeof(aw)==l){aw=true}if(av&&typeof av.hasClass=="function"&&av.hasClass("J_colorpicker_hex")){aw=true}if(ar==1&&aw){var aq={styleName:"xxxx",styleValue:"",editor:aB,notCreateNewNode:"false",tTag:"font"};h.getEventCtrl().setTagStyle(aq);setTimeout(function(){h.getEventCtrl().setTagStyle(aq);h.getEventCtrl().getWindowSelection().removeAllRanges()},200)}else{au=aB.attr("id");at=au.substring((au.indexOf("-")+1));ay=E("#fkEditor-toolBar-"+at).find(".tool-color ."+az.css+"-tool-icon");if(aD&&aD!=""){ay.css("background",aD);aA=ao.checkColorIsWhite(aD)}else{ay.css("background",ax);aA=ao.checkColorIsWhite(ax)}if(aA){ay.css("border","solid 1px #ccc")}else{ay.css("border","0px")}if(aD&&aD!=""){h.getEventCtrl().setTagStyle({styleName:"color",styleValue:aD,editor:aB,notCreateNewNode:aw,attr2:"color",attr2Value:ax})}else{h.getEventCtrl().setTagStyle({styleName:"color",styleValue:ax,editor:aB,notCreateNewNode:aw,attr2:"color",attr2Value:ax})}}return aj};ao.constructor.prototype.fkEditorSetColor=function(at,ar,aq,au){if(am){return}if(E.trim(h.getEventCtrl().getSelectText(ar,true)).length<=0){if(E.trim(ar.data(o.Range).toString()).length>0){h.getEventCtrl().setSelectRange(ar.data(o.Range))}clearTimeout(an);an=setTimeout(function(){if(E.trim(ar.data(o.Range).toString()).length>0){h.getEventCtrl().setSelectRange(ar.data(o.Range))}if(E.trim(h.getEventCtrl().getSelectText(ar,true)).length>0){ao.fkEditorSetColor(at,ar,aq,au);return}if(au&&au!=""){h.getEventCtrl().setTagStyle({styleName:"color",styleValue:au,editor:ar})}else{h.getEventCtrl().setTagStyle({styleName:"color",styleValue:aq,editor:ar})}},300);return}else{if(z){h.getEventCtrl().setSelectRange(ar.data(o.Range))}}am=true;clearTimeout(ap);ap=setTimeout(function(){var aw=ar.attr("id"),ax=aw.substring((aw.indexOf("-")+1)),av=E("#fkEditor-toolBar-"+ax).find(".tool-color ."+at.css+"-tool-icon"),ay=false;if(au&&au!=""){av.css("background",au);ay=ao.checkColorIsWhite(au)}else{av.css("background",aq);ay=ao.checkColorIsWhite(aq)}if(ay){av.css("border","solid 1px #ccc")}else{av.css("border","0px")}h.getEventCtrl().setSelection("ForeColor",aq);if(au&&au!=""){h.getEventCtrl().setTagStyle({styleName:"color",styleValue:au,editor:ar})}am=false},20)};ao.constructor.prototype.backTextSelectedStatus=function(ar){var au=ar.option,at=ar.editor;if(!E(".J_faiColorPickerAlp").is(":visible")||!E(".J_advanceColorPicker").data("open")){return aj}var aw=at.data(o.SignClassNum),ax=at.find("."+at.data(o.EditSignClass)+aw)[0],aq;if(r){aq=e.createRange();aq.selectNode(ax);ab.addRange(aq)}else{if(V){h.getEventCtrl().setSelectRange(at.data(o.Range))}else{h.getEventCtrl().setNodeRange(ax)}}var av=E("#fkEditor-toolBar-"+au.moduleId);colorBar=av.find(".tool-color ."+au.css+"-tool-icon");fontColor=E(ax).css("color");if(ao.checkColorIsWhite(fontColor)){colorBar.css("border","solid 1px #ccc")}else{colorBar.css("border","0px")}colorBar.css("background",fontColor);colorBar.removeClass("fk-colorPicker-transparentIco")}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createBtnToolDom=function(am){return _EditBtnBase.getUICtrl().createBtnToolDom(am)}};return ah=new ak()}};_EditColorBtn=new c();var A=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createHoverBtnToolDom=function(am){return _EditBtnBase.getUICtrl().createHoverBtnToolDom(am)}};return ah=new ak()}};_EditDeleteBtn=new A();var B=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var am=this,al;am.constructor.prototype.showFormatToolBar=function(ap){var aq=ap.option,ar=ap.toolbar,at=ar.find(".tool-formats"),ao=at.find("."+aq.css+"-formatBar"),an=ao.height()>0;ao.find(".formatDef").removeClass("formatDef");if(an){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aq)}else{ao.parent().find(".fkEditor-tool-iconNew").addClass("edTriangleOnNew");ao.addClass("formatBarSlideDown");_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aq,BtnCommand.Formats)}return aj};am.constructor.prototype.bindFormatSliderEvent=function(ao){var ar=ao.option,aq=ao.editor,at=ao.toolbar,au=at.find(".tool-formats"),ap=ar.moduleId.replace("module",""),an=au.find("."+ar.css+"-formatBar");_SelectedTool.getEventCtrl().bindMousewheelEvent(an);an.find("a").click(function(av){var aw;if(z){av.stopPropagation();!ar.btnModuleEdit&&h.getEventCtrl().setSelectRange(aq.data(o.Range))}an.find(".formatDef").removeClass("formatDef");E(this).addClass("formatDef");au.find(".selectDiv span").attr("title",E(this).attr(ar.css+"-formatName")).html(E(this).attr(ar.css+"-formatName"));if(!!ar.btnModuleEdit){aw={};aw.command=BtnCommand.Formats;aw.val=E(this).attr(ar.css+"-formatName");_EditBtnBase.getEventCtrl().selectChangeForBtnModuel(ao,aw)}else{h.getEventCtrl().setSelection("fontname",E(this).attr(ar.css+"-formatval"))}_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ar);return false}).hover(function(){an.find(".formatDef").removeClass("formatDef");E(this).addClass("formatDef")})}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createBtnToolDom=function(am){am.selectedData=am.option.EditFormatsBtn.selectedData;return _SelectedTool.getUICtrl().createSelectedSlideToolDom(am)}};return ah=new ak()}};_EditFormatsBtn=new B();var F=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var ao=this,an=false,am,al;ao.constructor.prototype.showSizeToolBar=function(av){var at=av.option,ax=av.toolbar,au=av.editor,ap=ax.find(".tool-fontSize"),ay=ap.find(".selectDivNew span"),aq=ap.find("."+at.css+"-formatBar"),aw=aq.height()>0,ar=300;aq.find(".formatDef").addClass("J_formatDef").removeClass("formatDef");if(aw){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(at)}else{ap.find(".selectDiv span").html(ap.find(".selectDiv span").attr("_value"));aq.parent().find(".fkEditor-tool-iconNew").addClass("edTriangleOnNew");aq.addClass("formatBarSlideDown");ay.attr(N.Contenteditable,true);clearTimeout(al);al=setTimeout(function(){h.getEventCtrl().setNodeRange(ay[0])},ar);_EditToolBase.getEventCtrl().animateHideToolSecondPanel(at,BtnCommand.FontSize)}return aj};ao.constructor.prototype.bindFontSizeEvent=function(ar){var av=ar.option,au=ar.editor,aw=ar.toolbar,at=ar.module,aq=aw.find(".tool-fontSize"),ax=aq.find(".selectDivNew span"),ap=aq.find("."+av.css+"-formatBar");_SelectedTool.getEventCtrl().bindMousewheelEvent(ap);_SelectedTool.getEventCtrl().bindInputEvent({element:ax,command:BtnCommand.FontSize,editor:au,btn:aq,option:av,module:at});ap.find("a").click(function(ay){var az;_EditToolBase.getEventCtrl().editToolLogDog({module:at,command:BtnCommand.ChooseFormats});ax.attr(N.Contenteditable,false);h.getEventCtrl().getWindowSelection().removeAllRanges();if(z){ay.stopPropagation();!av.btnModuleEdit&&h.getEventCtrl().setSelectRange(au.data(o.Range))}aq.find(".selectDiv span").attr("_value",E(this).attr(av.css+"-formatName").replace("px","")).html(E(this).attr(av.css+"-formatName"));if(!!av.btnModuleEdit){az={};az.command=BtnCommand.FontSize;az.val=E(this).attr(av.css+"-formatval");_EditBtnBase.getEventCtrl().selectChangeForBtnModuel(ar,az)}else{h.getEventCtrl().setTagStyle({styleName:"font-size",styleValue:E(this).attr(av.css+"-formatval"),editor:au,notCreateNewNode:true,createNewNodeAction:true})}_EditToolBase.getEventCtrl().animateHideToolSecondPanel(av);return false}).hover(function(){ap.find(".formatDef").removeClass("formatDef");E(this).addClass("formatDef")})}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createBtnToolDom=function(am){var an;am.selectedData=am.option.EditFontSizeBtn.selectedData;am.reSetUnselectable=" ";an=_SelectedTool.getUICtrl().createSelectedSlideToolDom(am);delete am.reSetUnselectable;return an}};return ah=new ak()}};_EditFontSizeBtn=new F();var t=function(){var ai;var ah;var aj=this;this._panelHeight=110;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var al=this;al.constructor.prototype.bindGlobalLinkPanelEvent=function(au){var aq=au.option,an=au.module,ar=au.editor,aw=au.toolbar,am=aw.find(".tool-link"),at=am.find("."+aq.css+"-linkSlideBar"),ao=at.find(".linkPanel"),av=150,ap="click.globalLinkBar mouseup.globalLinkBar";if(z){at.unbind(ap).bind(ap,function(ax){ax.stopPropagation()})}ao.find(".cancel").unbind("click.linkPanelCancel").bind("click.linkPanelCancel",function(){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aq)});ao.find(".confirm").unbind("click.linkPanelConfirm").bind("click.linkPanelConfirm",function(){if(!aq.saveGlobalJumpCtrlFun||aq.saveGlobalJumpCtrlFun==""){return}if(f.fkEval(aq.saveGlobalJumpCtrlFun)){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aq)}ar.trigger("change")});ao.find(".linkDelete").off("mouseenter.linkDeleteHover").on("mouseenter.linkDeleteHover",function(){if(ao.find(".linkSet").find(".jumpHref").val()==""){E(this).addClass("f-deleteDisable")}else{E(this).removeClass("f-deleteDisable")}}).off("click.linkDeleteClick").on("click.linkDeleteClick",function(){_EditToolBase.getEventCtrl().editToolLogDog({module:an,command:BtnCommand.DeleteLink});ao.find(".linkSet").find(".jumpHref").val("").removeAttr("disabled");ao.find(".linkSet").find(".jumpCtrl").attr({_lType:"0",_linkdeleteclick:true}).removeAttr("_lide target _lname _lurl _extJUrl");an.data("jumpIde","");E(this).trigger("mouseenter")})};al.constructor.prototype.showGlobalLinkPanel=function(an){var ap=an.option,ar=an.toolbar,au=200,aq=ar.find(".tool-link"),ao=ap.moduleId.replace("module",""),at=aq.find("."+ap.css+"-linkSlideBar"),am=at.find(".linkPanel");if(at.height()>0){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ap)}else{am.find(".linkSet").find(".jumpCtrl").removeAttr("_linkdeleteclick");am.addClass("fkEditorBarBorder");aq.find(".slideDiv").addClass("slideDivBorder");at.addClass("linkPanelSlide");_EditToolBase.getEventCtrl().editToolBarMask(ao)}};al.constructor.prototype.hideToolBarMask=function(){var am=E(".fk-dialog-hidden-mask");if(am.length>0){am.trigger("click")}}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createHoverBtnToolDom=function(an){var ar=an.option,ap=an.btn,ao=[],aq=ar.tipTitle,am="";if(aq){am=' data-title-tip="'+ap.title+'" '}ao.push('<div class="linkDiv slideDiv" '+C+">");ao.push("</div>");ao.push("<a "+C+' class="editToolIcon '+ap.command+'-tool-icon" command ="'+ap.command+'" '+am+" ></a>");ao.push('<div class="'+ar.css+'-linkSlideBar">');ao.push('<div class="linkPanel fkEditorBar">');ao.push(al.createLinkPanelDom(ar));ao.push("</div>");ao.push("</div>");ao.push("</div>");an.btnContent=ao.join("");ao=_EditBtnBase.getUICtrl().createHoverBtnToolDom(an);an.btnContent=null;return ao};al.constructor.prototype.createLinkPanelDom=function(an){var am=[];am.push('<div class="linkItem">');am.push('<div class="linkTip">链接地址：</div>');if(!an.btnModuleEdit){am.push('<div class="linkSet"><input id="jumpHref'+an.moduleId+'" class="jumpHref" maxlength="255"/></div>');am.push('<div title="删除" class="linkDelete f-deleteLink" style="display:block;">删除</div>')}else{am.push('<div class="linkSet"><input id="jumpHref'+an.moduleId.replace("module","")+'" class="jumpHref" maxlength="255"/></div>')}am.push("</div>");am.push('<div class="operaItem">');am.push('<div class="confirm" title="保存链接">确定</div>');am.push('<div class="cancel" title="取消">取消</div>');am.push("</div>");return am.join("")}};return ah=new ak()}};_EditGlobalLinkBtn=new t();var a=function(){var ai;var ah;var aj=this;this._panelHeight=45;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var al=this;al.constructor.prototype.bindOpacityPanelEvent=function(ax){var aq=ax.option,an=ax.module,at=ax.editor,aA=ax.toolbar,aB=aq.moduleId.replace("module",""),am=aA.find(".tool-opacity"),ar=am.find("."+aq.css+"-opacitySlideBar"),aw=ar.find(".opacityPanel"),az=150,ao="click.opacitySlideBar mouseup.opacitySlideBar";if(z){ar.unbind(ao).bind(ao,function(aD){aD.stopPropagation()})}var av=100-f.top.Site.getModuleAttrPattern(aB).transparent;var aC=aw.find(".opacityBar").css("left");aw.find(".inputVal").html(av+"%");aw.find(".opacityLhBar").css("width",av+"px");var au={animate:true,max:90,min:0,orientation:"horizontal",step:1,value:av,slide:ap,stop:ay};function ap(aD,aE){ar.find(".opacityLhBar").css("width",aE.value+"px");ar.find(".inputVal").html(aE.value+"%");ag.refreshFloatImgOpacity(aB,aE.value);f.top.Site.getModuleAttrPattern(aB).transparent=(100-aE.value)}function ay(aD,aE){f.top.Site.getModuleAttrPattern(aB).changed=true;ag.styleChanged()}setTimeout(function(){aw.find(".opacityBar").slider(au);_EditToolBase.getEventCtrl().bindSliderInputEvent(ar.find(".inputVal"),{onChange:function(aD){aw.find(".opacityBar").slider("value",aD);ar.find(".opacityLhBar").css("width",aD+"px");ag.refreshFloatImgOpacity(aB,aD);f.top.Site.getModuleAttrPattern(aB).transparent=(100-aD);ay()},maxVal:ar.find(".opacityBar").width()})},200)};al.constructor.prototype.showOpacityPanel=function(an){var aq=an.option,at=an.toolbar,au=200,am=at.find(".tool-opacity"),ap=aq.moduleId.replace("module",""),ao=am.find("."+aq.css+"-opacitySlideBar"),ar=ao.find(".opacityPanel");if(ar.height()>0){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aq,BtnCommand.Opacity)}else{ar.addClass("f-opacityPanel-show");am.find(".slideDiv").addClass("slideDivBorder");_EditToolBase.getEventCtrl().editToolBarMask(ap)}}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createHoverBtnToolDom=function(an){var ar=an.option,ap=an.btn,ao=[],aq=ar.tipTitle,am="";if(aq){am=' data-title-tip="'+ap.title+'" '}ao.push('<div class="opacityDiv slideDiv" '+C+">");ao.push("</div>");ao.push("<a "+C+' class="f-editToolIcon editToolIcon '+ap.command+'-tool-icon" command ="'+ap.command+'" '+am+" ></a>");ao.push('<div class="opacitySlideBarForBtnM '+ar.css+"-opacitySlideBar f-"+ar.css+'-opacitySlideBar ">');ao.push('<div class="f-opacityPanel f-fkEditorBar opacityPanel fkEditorBar">');ao.push(al.createOpacityPanelDom(ar));ao.push("</div>");ao.push("</div>");ao.push("</div>");an.btnContent=ao.join("");ao=_EditBtnBase.getUICtrl().createHoverBtnToolDom(an);an.btnContent=null;return ao};al.constructor.prototype.createOpacityPanelDom=function(an){var am=[];am.push('<div class="opacityBar f-slideBar" ></div>');am.push('<div class="opacityLhBar f-select-slideBar"></div>');am.push('<div class="inputVal f-inputVal">0%</div>');return am.join("")}};return ah=new ak()}};_EditOpacityBtn=new a();var s=function(){var ai;var ah;var aj=this;this._panelHeight=55;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var al=this;al.constructor.prototype.bindBorderPanelEvent=function(aq){var aA=aq.option,ap=aq.module,au=aq.editor,ax=aq.toolbar,am=aA.moduleId.replace("module",""),aw=ax.find(".tool-border"),az=aw.find("."+aA.css+"-borderSlideBar"),aE=az.find(".borderPanel"),ao=150,aC="click.borderSlideBar mouseup.borderSlideBar";if(z){az.unbind(aC).bind(aC,function(aG){aG.stopPropagation()})}var aD=f.top.Site.getModuleAttrPattern(am).floatBtn.b;var at=8,an=0,ay=1,aF=aD.w||0;if(aD.t==0){aF=0}var ar={animate:true,max:at,min:an,orientation:"horizontal",step:ay,value:aF,slide:aB,stop:av};aE.find(".setBorderSize").slider(ar);az.find(".inputVal").html(aF+"px");az.find(".borderSizeBar").css("width",(aF*11)+"px");az.find(".borderColor").css("background",aD.c);_EditToolBase.getEventCtrl().bindSliderInputEvent(az.find(".inputVal"),{onChange:function(aG){aE.find(".setBorderSize").slider("value",aG);az.find(".borderSizeBar").css("width",(aG*11)+"px");aD.t=2;aD.w=aG;ag.setFlBtnBorderChang(am,aD);av()},maxVal:at,per:"px"});function aB(aG,aH){az.find(".borderSizeBar").css("width",(aH.value*11)+"px");aD.t=2;aD.w=aH.value;az.find(".inputVal").html(aH.value+"px");ag.setFlBtnBorderChang(am,aD)}function av(aG,aH){f.top.Site.getModuleAttrPattern(am).changed=true;ag.styleChanged()}az.find(".borderColor").off("click.b").on("click.b",function(aI){f.isMozilla()&&aI.stopPropagation();function aH(aK){az.find(".borderColor").css("background",aK);aD.t=2;aD.c=aK;ag.setFlBtnBorderChang(am,aD);f.top.Site.getModuleAttrPattern(am).changed=true;ag.styleChanged()}function aG(aL,aK){if(aL==2){az.find(".borderColor").css("background",aK);aD.t=2;aD.c=aK;ag.setFlBtnBorderChang(am,aD);f.top.Site.getModuleAttrPattern(am).changed=true;ag.styleChanged()}}var aJ={moduleId:am,target:az.find(".borderColor"),inputHexStatus:aG,onchange:aH,appendToWeb:true,hideAfterSet:true,__left:328,__top:83};E(aw).find(".editToolIcon").faiColorPickerAlp(aJ)})};al.constructor.prototype.showBorderPanel=function(am){var ao=am.option,aq=am.toolbar,at=200,ap=aq.find(".tool-border"),an=ao.moduleId.replace("module",""),ar=ap.find("."+ao.css+"-borderSlideBar"),au=ar.find(".borderPanel");if(au.height()>0){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ao,BtnCommand.Border)}else{au.addClass("f-borderPanel-show");ap.find(".slideDiv").addClass("slideDivBorder");_EditToolBase.getEventCtrl().editToolBarMask(an)}}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createHoverBtnToolDom=function(an){var ar=an.option,ap=an.btn,ao=[],aq=ar.tipTitle,am="";if(aq){am=' data-title-tip="'+ap.title+'" '}ao.push('<div class="borderDiv slideDiv" '+C+">");ao.push("</div>");ao.push("<a "+C+' class="f-editToolIcon editToolIcon '+ap.command+'-tool-icon" command ="'+ap.command+'" '+am+" ></a>");ao.push('<div class=" '+ar.css+"-borderSlideBar f-"+ar.css+'-borderSlideBar ">');ao.push('<div class="f-borderPanel f-fkEditorBar borderPanel fkEditorBar">');ao.push(al.createBorderPanelDom(ar));ao.push("</div>");ao.push("</div>");ao.push("</div>");an.btnContent=ao.join("");ao=_EditBtnBase.getUICtrl().createHoverBtnToolDom(an);an.btnContent=null;return ao};al.constructor.prototype.createBorderPanelDom=function(an){var am=[];am.push('<div class="f-item">');am.push('<div class="f-tip">大小</div>');am.push('<div class="setBorderSize f-slideBar"></div>');am.push('<div class="borderSizeBar f-select-slideBar"></div>');am.push('<div class="inputVal f-inputVal">0px</div>');am.push("</div>");am.push('<div class="f-item">');am.push('<div class="f-tip">颜色</div>');am.push('<div class="borderColor f-color-select"></div>');am.push("</div>");return am.join("")}};return ah=new ak()}};_EditBorderBtn=new s();var n=function(){var ai;var ah;var aj=this;this._panelHeight=130;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var al=this;al.constructor.prototype.bindShadowPanelEvent=function(ar){var aC=ar.option,ap=ar.module,au=ar.editor,aA=ar.toolbar,am=aC.moduleId.replace("module",""),aE=aA.find(".tool-shadow"),aG=aE.find("."+aC.css+"-shadowSlideBar"),av=aG.find(".shadowPanel"),ao=150,aB="click.shadowSlideBar mouseup.shadowSlideBar";if(z){aG.unbind(aB).bind(aB,function(aJ){aJ.stopPropagation()})}var ax=f.top.Site.getModuleAttrPattern(am).floatBtn.sh;var az=ax.dx,ay=ax.dy,aI=ax.f;if(ax.t==0){az=0;ay=0;aI=0}var at={animate:true,max:110,min:0,orientation:"horizontal",step:1,value:az,slide:aD,stop:aH};var aF={animate:true,max:110,min:0,orientation:"horizontal",step:1,value:ay,slide:an,stop:aH};var aq={animate:true,max:110,min:0,orientation:"horizontal",step:1,value:aI,slide:aw,stop:aH};av.find(".setShadowX").slider(at);aG.find(".J_inputValX").html(az+"px");_EditToolBase.getEventCtrl().bindSliderInputEvent(aG.find(".J_inputValX"),{onChange:function(aJ){av.find(".setShadowX").slider("value",aJ);aG.find(".shadowXBar").css("width",aJ+"px");ax.t=2;ax.dx=aJ;ag.setFlBtnShadowChange(am,ax);aH()},per:"px",maxVal:at.max,maxLength:4});av.find(".setShadowY").slider(aF);aG.find(".J_inputValY").html(ay+"px");_EditToolBase.getEventCtrl().bindSliderInputEvent(aG.find(".J_inputValY"),{onChange:function(aJ){av.find(".setShadowY").slider("value",aJ);aG.find(".shadowYBar").css("width",aJ+"px");ax.t=2;ax.dy=aJ;ag.setFlBtnShadowChange(am,ax);aH()},per:"px",maxVal:aF.max,maxLength:4});av.find(".setShadowStyle").slider(aq);aG.find(".J_inputValS").html(aI+"px");_EditToolBase.getEventCtrl().bindSliderInputEvent(aG.find(".J_inputValS"),{onChange:function(aJ){av.find(".setShadowStyle").slider("value",aJ);aG.find(".shadowStyleBar").css("width",aJ+"px");ax.t=2;ax.f=aJ;ag.setFlBtnShadowChange(am,ax);aH()},per:"px",maxVal:aq.max});aG.find(".shadowXBar").css("width",(ax.dx)+"px");aG.find(".shadowYBar").css("width",(ax.dy)+"px");aG.find(".shadowStyleBar").css("width",(ax.f)+"px");aG.find(".shadowColor").css("background",ax.c);function aD(aJ,aK){aG.find(".shadowXBar").css("width",(aK.value)+"px");aG.find(".J_inputValX").html(aK.value+"px");ax.t=2;ax.dx=aK.value;ag.setFlBtnShadowChange(am,ax)}function an(aJ,aK){aG.find(".shadowYBar").css("width",(aK.value)+"px");aG.find(".J_inputValY").html(aK.value+"px");ax.t=2;ax.dy=aK.value;ag.setFlBtnShadowChange(am,ax)}function aw(aJ,aK){aG.find(".shadowStyleBar").css("width",(aK.value)+"px");aG.find(".J_inputValS").html(aK.value+"px");ax.t=2;ax.f=aK.value;ag.setFlBtnShadowChange(am,ax)}function aH(aJ,aK){f.top.Site.getModuleAttrPattern(am).changed=true;ag.styleChanged()}aG.find(".shadowColor").off("click.s").on("click.s",function(aL){f.isMozilla()&&aL.stopPropagation();function aK(aN){aG.find(".shadowColor").css("background",aN);ax.t=2;ax.c=aN;ag.setFlBtnShadowChange(am,ax);f.top.Site.getModuleAttrPattern(am).changed=true;ag.styleChanged()}function aJ(aO,aN){aG.find(".shadowColor").css("background",aN);ax.t=2;ax.c=aN;ag.setFlBtnShadowChange(am,ax);f.top.Site.getModuleAttrPattern(am).changed=true;ag.styleChanged()}var aM={moduleId:am,target:aG.find(".shadowColor"),inputHexStatus:aJ,onchange:aK,appendToWeb:true,hideAfterSet:true,__left:328,__top:143};E(aE).find(".editToolIcon").faiColorPickerAlp(aM)})};al.constructor.prototype.showShadowPanel=function(am){var ap=am.option,aq=am.toolbar,au=200,ao=aq.find(".tool-shadow"),an=ap.moduleId.replace("module",""),at=ao.find("."+ap.css+"-shadowSlideBar"),ar=at.find(".shadowPanel");if(ar.height()>0){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ap,BtnCommand.Shadow)}else{ar.addClass("f-shadowPanel-show");ao.find(".slideDiv").addClass("slideDivShadow");_EditToolBase.getEventCtrl().editToolBarMask(an)}}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createHoverBtnToolDom=function(an){var ar=an.option,ap=an.btn,ao=[],aq=ar.tipTitle,am="";if(aq){am=' data-title-tip="'+ap.title+'" '}ao.push('<div class="shadowDiv slideDiv" '+C+">");ao.push("</div>");ao.push("<a "+C+' class="f-editToolIcon editToolIcon '+ap.command+'-tool-icon" command ="'+ap.command+'" '+am+" ></a>");ao.push('<div class=" '+ar.css+"-shadowSlideBar f-"+ar.css+'-shadowSlideBar ">');ao.push('<div class="f-shadowPanel f-fkEditorBar shadowPanel fkEditorBar">');ao.push(al.createShadowPanelDom(ar));ao.push("</div>");ao.push("</div>");ao.push("</div>");an.btnContent=ao.join("");ao=_EditBtnBase.getUICtrl().createHoverBtnToolDom(an);an.btnContent=null;return ao};al.constructor.prototype.createShadowPanelDom=function(an){var am=[];am.push('<div class="f-item">');am.push('<div class="f-tip">X轴</div>');am.push('<div class="setShadowX f-slideBar"></div>');am.push('<div class="shadowXBar f-select-slideBar"></div>');am.push('<div class="f-inputVal inputVal J_inputValX"></div>');am.push("</div>");am.push('<div class="f-item">');am.push('<div class="f-tip">Y轴</div>');am.push('<div class="setShadowY f-slideBar"></div>');am.push('<div class="shadowYBar f-select-slideBar"></div>');am.push('<div class="f-inputVal inputVal J_inputValY"></div>');am.push("</div>");am.push('<div class="f-item">');am.push('<div class="f-tip">阴影</div>');am.push('<div class="setShadowStyle f-slideBar"></div>');am.push('<div class="shadowStyleBar f-select-slideBar"></div>');am.push('<div class="f-inputVal inputVal J_inputValS"></div>');am.push("</div>");am.push('<div class="f-item">');am.push('<div class="f-tip">颜色</div>');am.push('<div class="shadowColor f-color-select"></div>');am.push("</div>");return am.join("")}};return ah=new ak()}};_EditShadowBtn=new n();var M=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var al=this;al.constructor.prototype.bindRadiusBtnEvent=function(ao){var aA=ao.option,an=ao.module,az=ao.toolbar,aw,aB,aD,ax=false,at=false,am=aA.moduleId.replace("module",""),aE=ag.getModuleAttrPattern(am).floatBtn,au=aE.r,ar=aE.s.w||163,ap=aE.s.h||52,ay;if(parseInt(ar/2)>parseInt(ap/2)){ay=parseInt(ap/2)}else{ay=parseInt(ar/2)}aw=az.find(".setRadiusBar");if(aw.length<1){return}function aq(aG,aH){aw.data("radiusSliding",true);_EditToolBase.getEventCtrl().editToolLogDog({module:an,command:E(ao.thisBtnElement).attr("command")})}function aF(aG,aH){au.t=2;au.lb=aH.value;au.lt=aH.value;au.rb=aH.value;au.rt=aH.value;ag.setFlBtnRadiusChange(am,au)}function aC(aG,aH){aw.data("radiusSliding",false);f.top.Site.getModuleAttrPattern(am).changed=true;ag.styleChanged();E(aH.handle).blur()}var av={max:ay,min:0,orientation:"horizontal",step:2,value:au.lt>ay?ay:au.lt,start:aq,slide:aF,stop:aC};aw.slider(av);an.find(".ui-resizable-handle").off("mouseover.radius").on("mouseover.radius",function(){az.find(".setRadiusBar").show()}).off("mouseleave.radius").on("mouseleave.radius",function(){if(az.find(".setRadiusBar").data("radiusSliding")){return}az.find(".setRadiusBar").hide()});aw.off("mouseover.radius").on("mouseover.radius",function(){az.find(".setRadiusBar").show()}).off("mouseleave.radius").on("mouseleave.radius",function(){if(az.find(".setRadiusBar").data("radiusSliding")){return}az.find(".setRadiusBar").hide()})}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createEditRadiusBtnDom=function(am){var ao=am.option,ap=am.toolbar,an="",aq;aq=ap.find(".setRadiusBar");if(aq.length>0){return}an+="<div class='setRadiusBar f-setRadiusBar' title='左右拖动改变圆角'></div>";ap.append(an);return aj}};return ah=new ak()}};_EditRadiusBtn=new M();var D=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createBtnToolDom=function(am){return _EditBtnBase.getUICtrl().createBtnToolDom(am)}};return ah=new ak()}};_EditItalicBtn=new D();var j=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var am=this,al;am.constructor.prototype.setLinkAttr=function(an){var ao=an.element;ao.attr("href",an._lurl);ao.attr("_ltype",an._ltype);ao.attr("_lide",an._lide);ao.attr("_lname",an._lname);ao.attr("target",an._target);return aj};am.constructor.prototype.setChildLink=function(ao){var aq=ao.element,an=ao.wrapStr,at,ar;if(!aq||aq.text().length<=0||!(aq.find("div").length>0||aq.find("p").length>0)){return}for(var ap=0;ap<aq.children().length;ap++){at=aq.children().eq(ap);if((at.find("div").length>0||at.find("p").length>0)&&at.text().length>0){am.setChildLink({element:at,wrapStr:an})}else{if(at.text().length>0){ar=E(an).html(at.html());at.html(ar)}}}return aj};am.constructor.prototype.handTagANotJump=function(an){an.find("a").each(function(){var ao=E(this).attr("href");if(ao!=l&&ao!=""){E(this).attr("_href",ao);E(this).attr("href","")}})};am.constructor.prototype.setLinkAll=function(au){var an=au.text().length,ao,aB,ap=0;if(an<=0||!au){return aj}if(au.children().length<=0){if(au.text().length<=0){return aj}ao=au.prop("tagName").toLowerCase();if(ao!="a"){aB=au.parent("a");if(aB&&aB.length>=0){aB=aB.clone();aB.text(au.text());au.html(aB.prop("outerHTML"))}}return aj}for(var av=0;av<au.children().length;av++){ap+=au.children().eq(av).text().length}var ar,ay,aA="'.?+'",aq,at,ax,aB,ao,az,aw;if(an!=ap&&ap>0){ar=au.clone();ay=[];for(var av=0;av<ar.children().length;av++){ay.push(au.children().eq(av));ar.children().eq(av).prop("outerHTML",aA)}aq=[];at=ar.html();ax=0;aB="";ao=au.prop("tagName").toLowerCase();if(ao!="a"){aB=au.parent("a")}else{aB=au}if(aB&&aB.length>=0){for(var av=0;av<ay.length;av++){ax=at.indexOf(aA);if(ax<0||at.length<=0){break}else{if(ax==0){if(!ay[av].attr("style")){ay[av].attr("style",aB.attr("style"))}aq.push(ay[av].prop("outerHTML"));if(at.length>aA.length){at=at.substring(aA.length,at.length)}else{at=""}if(at.length>0){ax=at.indexOf(aA);if(ax<0){aw=aB.clone();aw.html(at);aq.push(aw.prop("outerHTML"));at=""}else{if(ax>0){az=at.substr(0,ax);if(at.length>aA.length){at=at.substring(aA.length,at.length)}else{at=""}aw=aB.clone();aw.html(az);aq.push(aw.prop("outerHTML"))}}}}else{az=at.substr(0,ax);aw=aB.clone();aw.html(az);aq.push(aw.prop("outerHTML"));if(at.length>ax+aA.length){at=at.substring(ax+aA.length,at.length)}else{at=""}if(!ay[av].attr("style")){ay[av].attr("style",aB.attr("style"))}aq.push(ay[av].prop("outerHTML"))}}}if(at.length>0){aw=aB.clone();aw.html(at);aq.push(aw.prop("outerHTML"))}au.html(aq.join(""))}}for(var av=0;av<au.children().length;av++){am.setLinkAll(au.children().eq(av))}return aj};am.constructor.prototype.fkEditorSetLink=function(aA){var ay=aA.editor,at=aA.jumpCtrl,aq=aA.isGloableLink,av=aA.option;if(!at){return aj}if(av.editorName=="corpTitle"){ag.saveTitleJumpUrl(at,ay);return}var au=at.attr("_ltype"),ao=at.attr("_lide"),aB=at.attr("_lname"),az=at.attr("_lurl"),an=at.attr("target"),aC=at.attr("_linkdeleteclick"),ap,ax,ar=false,aw;ay.attr(N.Contenteditable,true);if(aq){h.getEventCtrl().setNodeRange(ay[0]);if(aC=="true"&&(typeof(ao)==l||E.trim(ao)=="")){h.getEventCtrl().setSelection("Unlink");setTimeout(function(){if(!ay.data(o.SimpleTextEdit)){ay.attr(N.Contenteditable,false)}},300);return}}else{h.getEventCtrl().setSelectRange(ay.data(o.Range))}if(typeof(az)==l){return}if(au==108){an=""}ax=E(h.getEventCtrl().getSelectedNode());if(ax){ar=ax.css("color")==ay.css("color")}if(ar){h.getEventCtrl().setTagStyle({styleName:"color",styleValue:"#496EE8",isSetLinkColor:true,editor:ay})}ap=az+"&_saltLurl";h.getEventCtrl().setSelection(BtnCommand.Createlink,ap);clearTimeout(al);al=setTimeout(function(){var aD=ay.find("a"),aE,aG=ay.attr("style");if(aD.length<=0){return}ay.height(ay.height()+"px");for(var aF=0;aF<aD.length;aF++){aE=aD.eq(aF);if(aE.text().length<=0){aE.remove()}if(ap!=aE.attr("href")){continue}var aI={element:aE,_lurl:az,_ltype:au,_lide:ao,_lname:aB,_target:an};am.setLinkAttr(aI);aw="<a href='"+az+"' _ltype='"+au+"' _lide='"+ao+"' _lname='"+aB+"' target='"+an+"'>";am.setChildLink({element:aE,wrapStr:aw});if(ar){aE.css("color","#496EE8")}if(r){var aH=T.getEventCtrl().findTagInParent(aE,"a",ay.data(o.EndCheckClass));if(aH){am.setLinkAll(aH)}}}ay.attr("style",aG);if(!ay.data(o.SimpleTextEdit)){ay.attr(N.Contenteditable,false)}},500);return aj};am.constructor.prototype.getLinkPreData=function(){var ar=0,ay=1,ap="",aw="",an="",at={_ltype:ar,_lide:ap,_lname:aw,_target:an,_moduleType:ay};if(V){return at}var av=h.getEventCtrl().getWindowSelection(),au;if(!av.anchorNode||!av.getRangeAt){return at}au=av.getRangeAt(0);var ax=E(au.endContainer).find("a");if(ax.length<=0){ax=E(au.endContainer).closest("a");if(ax.length<=0){return at}}for(var aq=0;aq<ax.length;aq++){var ao=ax.eq(aq);if(ao.attr("_lide")&&ao.attr("_lide")!=null){ar=ao.attr("_ltype");ap=ao.attr("_lide");aw=ao.attr("_lname");an=ao.attr("target");break}}return at={_ltype:ar,_lide:ap,_lname:aw,_target:an,_moduleType:ay}};am.constructor.prototype.getCorpTitleLinkPreData=function(){var au=0,ap=1,ao="",ar="",an="",aq={},at=f.top._titleData.jm.y;if(f.top._titleData.jm.jName==null){f.top._titleData.jm.jType=0;f.top._titleData.jm.f="";f.top._titleData.jm.y=0}if(at===1){f.top._titleData.jm.y=2}else{if(at===0){f.top._titleData.jm.jType=0;f.top._titleData.jm.f="";f.top._titleData.jm.jUrl="";f.top._titleData.jm.jName=""}}au=f.top._titleData.jm.jType||0;ao=f.top._titleData.jm.f||"",ar=f.top._titleData.jm.jName,an=f.top._titleData.jm.ot==1?"_blank":"";ap=8;return aq={_ltype:au,_lide:ao,_lname:ar,_target:an,_moduleType:ap}};am.constructor.prototype.getGlobalLinkPreData=function(au,av){var ar=0,ay=1,ap="",aw="",an="",at={},aq=av.option;var ax=au.find("a"),ao;if(aq.btnModuleEdit){ax=av.module}if(ax.length>1){ao=ax.eq(0)}else{ao=ax}if(ao.attr("_lide")&&ao.attr("_lide")!=null){ar=ao.attr("_ltype");ap=ao.attr("_lide");aw=ao.attr("_lname");an=ao.attr("target")}return at={_ltype:ar,_lide:ap,_lname:aw,_target:an,_moduleType:ay}}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createBtnToolDom=function(am){return _EditBtnBase.getUICtrl().createBtnToolDom(am)}};return ah=new ak()}};_EditLinkBtn=new j();var K=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var an=this,am=false,al;an.constructor.prototype.showLineHiehgtToolBar=function(at){var ar=at.option,av=at.toolbar,ax=av.find(".tool-lineHeight"),ap=ax.find(".selectDiv"),aw=ax.find(".selectDiv span"),ao=ax.find("."+ar.css+"-formatBar"),au=ao.height()>0,aq=300;if(au){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ar)}else{ao.addClass("formatBarSlideDown");ao.find(".formatDef").addClass("J_formatDef").removeClass("formatDef");ap.removeClass("selectDivNew");ap.find("span").html(ap.find("span").attr("_value"));ao.parent().find(".fkEditor-tool-iconNew").addClass("edTriangleOnNew");aw.attr(N.Contenteditable,true);clearTimeout(al);al=setTimeout(function(){h.getEventCtrl().setNodeRange(aw[0])},aq);_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ar,BtnCommand.LineHeight)}return aj};an.constructor.prototype.bindLineHeihgtSliderBarEvent=function(at){var aq=at.option,ar=at.editor,au=at.toolbar,ao=at.module,ax=au.find(".tool-lineHeight"),av=ax.find(".selectDiv span"),ap=ax.find("."+aq.css+"-formatBar"),aw;_SelectedTool.getEventCtrl().bindMousewheelEvent(ap);_SelectedTool.getEventCtrl().bindInputEvent({element:av,command:BtnCommand.LineHeight,editor:ar,btn:ax,option:aq,module:ao});ap.find("a").click(function(ay){_EditToolBase.getEventCtrl().editToolLogDog({module:ao,command:BtnCommand.ChooseLineHeight});av.attr(N.Contenteditable,false);h.getEventCtrl().getWindowSelection().removeAllRanges();if(z){ay.stopPropagation();h.getEventCtrl().setSelectRange(ar.data(o.Range))}aw=E(this).attr(aq.css+"-formatName").replace("px","");ax.find(".selectDiv span").attr("_value",aw).html(aw);h.getEventCtrl().setTagStyle({styleName:"line-height",styleValue:E(this).attr(aq.css+"-formatval"),editor:ar,notCreateNewNode:true,createNewNodeAction:true});_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aq);return false}).hover(function(){ap.find(".formatDef").removeClass("formatDef");E(this).addClass("formatDef")})}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createBtnToolDom=function(am){var an;am.selectedData=am.option.EditLineHeightBtn.selectedData;am.reSetUnselectable=" ";an=_SelectedTool.getUICtrl().createSelectedSlideToolDom(am);delete am.reSetUnselectable;return an}};return ah=new ak()}};_EditLineHeightBtn=new K();var b=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createBtnToolDom=function(am){return _EditBtnBase.getUICtrl().createBtnToolDom(am)}};return ah=new ak()}};_EditUnderlineBtn=new b();var g=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var al=this;al.constructor.prototype.adjustWritingModeState=function(an){var ar=an.toolbar,aq=an.option.moduleId,ap=an.option,ao=an.editor,am=ar.find(".tool-textAlign");if(ao.hasClass("fk-editor-vertical-rl")){ar.find(".tool-lineHeight").find(".selectDiv span").addClass("lrLineHeight-tool-icon");am.find(".selectDiv span").addClass("lrTextAlign-tool-icon");am.find("."+ap.css+"-formatBarNew").addClass("lrTextAlign");am.find(".justifyLeft .fkEditor-tool-icon").addClass("lrTextAlignLeft-tool-icon");am.find(".justifyLeft").parent().find(".formatMg").text("上对齐");am.find(".justifyCenter .fkEditor-tool-icon").addClass("lrTextAlignCenter-tool-icon");am.find(".justifyRight .fkEditor-tool-icon").addClass("lrTextAlignRight-tool-icon");am.find(".justifyRight").parent().find(".formatMg").text("下对齐");ar.find(".tool-writingMode").find(".fkEditor-tool-icon").addClass("lrWritingMode-tool-icon")}else{ar.find(".tool-lineHeight").find(".selectDiv span").removeClass("lrLineHeight-tool-icon");am.find(".selectDiv span").removeClass("lrTextAlign-tool-icon");am.find("."+ap.css+"-formatBarNew").removeClass("lrTextAlign");am.find(".justifyLeft .fkEditor-tool-icon").removeClass("lrTextAlignLeft-tool-icon");am.find(".justifyLeft").parent().find(".formatMg").text("左对齐");am.find(".justifyCenter .fkEditor-tool-icon").removeClass("lrTextAlignCenter-tool-icon");am.find(".justifyRight .fkEditor-tool-icon").removeClass("lrTextAlignRight-tool-icon");am.find(".justifyRight").parent().find(".formatMg").text("右对齐");ar.find(".tool-writingMode").find(".fkEditor-tool-icon").removeClass("lrWritingMode-tool-icon")}return aj};al.constructor.prototype.switchWritingMode=function(ao){var ay=ao.option,an=ao.module,ax=ao.toolbar,aF=ay.moduleId,ar=ao.editor,av="",au,aB="1000",am="40px",aw="40px",az="10px",aE=521,at="10px",aA="1200px",ap=an.width(),aD=an.height(),au,aC=ar.hasClass("fk-editor-vertical-rl"),aq=an.find(".J_resizableTip");if(ar.length==0){return aj}an.css({"min-width":"","min-height":"","max-height":"","max-height":""}).find(".fk-editor").css({"min-width":"","min-height":"","max-height":"","max-height":""});if(aC){ar.removeClass("fk-editor-vertical-rl");an.data(o.OldVHeight,aD);an.css("width",(an.data(o.OldHwidth)||aE)+"px");ar.css("width",an.width()+"px");an.css({"max-height":""}).find(".fk-editor").css({"max-height":""});an.css({"min-height":am,"min-width":az,"max-width":aA}).find(".fk-editor").css({"min-height":am,"min-width":az,"max-width":aA});ag.absModuleAutoHeight(aF.replace("module",""))}else{ar.addClass("fk-editor-vertical-rl").attr("_autowidth",1);aq.attr({_faiscoTip:"还原模块默认宽度",onclick:"Site.simpleTextAutoWidth('"+aF+"');return false;"});an.data(o.OldHwidth,ap);an.css({"max-width":""}).find(".fk-editor").css({"max-width":""});an.css({"min-width":aw,"min-height":at,"max-height":aA}).find(".fk-editor").css({"min-width":aw,"min-height":at,"max-height":aA})}al.adjustWritingModeState(ao);if(!aC){au=ar.height();an.css("height",(an.data(o.OldVHeight)||220)+"px");ar.css("height",(an.data(o.OldVHeight)||220)+"px");ag.simpleTextAutoWidth(aF)}ag.simpleTextResize(an)}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createBtnToolDom=function(am){return _EditBtnBase.getUICtrl().createBtnToolDom(am)}};return ah=new ak()}};_EditWritingModeBtn=new g();var Y=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var al=this;al.constructor.prototype.showTextAlignBtnPanel=function(ao){var aq=ao.option,ar=ao.toolbar,at=ar.find(".tool-textAlign"),an=at.find("."+aq.css+"-formatBar"),ap=at.find(".selectDiv"),am=an.height()>0;if(am){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aq)}else{ap.removeClass("selectDivNew");an.find(".formatDef").addClass("J_formatDef").removeClass("formatDef");an.find(".justify").removeClass("justifyLeftHover justifyCenterHover justifyRightHover");an.parent().find(".fkEditor-tool-iconNew").addClass("edTriangleOnNew");an.addClass("textAlignSlideDown formatBarSlideDown");_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aq,BtnCommand.TextAlign)}return aj};al.constructor.prototype.textAlignEmphasize=function(am){var ao=am.editor,ap=am.toolbar,ar=am.command,aq=ap.find(".tool-textAlign"),an=aq.find(".selectDiv");switch(ar){case BtnCommand.JustifyLeft:an.removeClass("selectJustifyCenter selectJustifyRight");break;case BtnCommand.JustifyCenter:an.addClass("selectJustifyCenter");an.removeClass("selectJustifyRight");break;case BtnCommand.JustifyRight:an.addClass("selectJustifyRight");an.removeClass("selectJustifyCenter");break;default:break}return aj};al.constructor.prototype.bindTextAlignSliderBarEvent=function(ao){var ar=ao.option,aq=ao.editor,ap=ao.module,at=ao.toolbar,au,am,an=at.find(".tool-textAlign").find("."+ar.css+"-formatBar");an.find(".fkEditor-formatSlidebg").remove();an.find(".fkEditor-formatSlider").remove();an.find("a").click(function(av){if(z){av.stopPropagation();h.getEventCtrl().setSelectRange(aq.data(o.Range))}au=E(this).attr(ar.css+"-formatval");_EditToolBase.getEventCtrl().editToolLogDog({module:ap,command:au});al.constructor.prototype.textAlignEmphasize({editor:aq,toolbar:at,command:au});h.getEventCtrl().setSelection(au);_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ar);return false}).hover(function(){am=E(this);an.find(".formatDef").removeClass("formatDef");an.find(".justify").removeClass("justifyLeftHover justifyCenterHover justifyRightHover");am.addClass("formatDef");au=am.attr(ar.css+"-formatval");switch(au){case BtnCommand.JustifyLeft:am.find(".justify").addClass("justifyLeftHover");break;case BtnCommand.JustifyCenter:am.find(".justify").addClass("justifyCenterHover");break;case BtnCommand.JustifyRight:am.find(".justify").addClass("justifyRightHover");break;default:break}})}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createBtnToolDom=function(am){am.selectedData=am.option.EditTextAlignBtn.selectedData;return _SelectedTool.getUICtrl().createSelectedSlideToolDom(am)}};return ah=new ak()}};_EditTextAlignBtn=new Y();var U=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.createBtnToolDom=function(am){return _EditBtnBase.getUICtrl().createBtnToolDom(am)}};return ah=new ak()}};_EditRemoveFormatBtn=new U();var L=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var al=this;al.constructor.prototype.getOuterFunc=function(){return ak={fkEditorSetLink:_EditLinkBtn.getEventCtrl().fkEditorSetLink,fkEditorSetColor:_EditColorBtn.getEventCtrl().fkEditorSetColor,simpleTextColorInputHexStatus:_EditColorBtn.getEventCtrl().simpleTextColorInputHexStatus,simpleTextFormatPasteData:_EditorBase.getEventCtrl().simpleTextFormatPasteData,deleteOrHideToolBar:_EditToolBase.getEventCtrl().deleteOrHideToolBar,animateHideToolSecondPanel:_EditToolBase.getEventCtrl().animateHideToolSecondPanel}}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}return ah=new func()}};_EditorOuterFunc=new L();var i=function(){var ai;var ah;var aj=this;this.getEventCtrl=function(){if(ai){return ai}var ak=function(){var au=this,al,ax,at,ar="keypress.fkeditorClick keyup.fkeditorClick keydown.fkeditorClick drop.fkeditorClick cut.fkeditorClick copy.fkeditorClick paste.fkeditorClick DOMCharacterDataModified.fkeditorClick DOMSubtreeModified.fkeditorClick",am="change.fkeditorClick",an="click.fkeditorClick",ap="mouseover.fkeditorClick",ao="mouseleave.fkeditorClick",aq="mousedown.fkeditorClick",av="mousemove.fkeditorClick",ay="mouseup.fkeditorClick",aw="keyup.fkeditorClick";au.constructor.prototype.bindEditorEvent=function(az){var aC=az.option,aA=az.module,aB=az.editor,aD=az.toolbar,aE=aB.find(".editTip");emphasize=aC.css+"-tool-depressedNew",emphasizeHover=aC.css+"-tool-depressedNewHover",emphasizeShow=aC.css+"-tool-depressedNewShow";aE.unbind("click.editTipbutton").bind("click.editTipbutton",function(){aB.focus();return false});if(aB.data(o.EditorEventBind)){return}aB.data(o.EditorEventBind,true);aB.unbind(ar).bind(ar,function(aF){E(this).trigger("change");if(!!aC.btnModuleEdit){if(aF.which==13){return false}}}).unbind(am).bind(am,function(){if(aB.data(o.ChangeCount)>aC.changeCount){if(aC.pageChangeFun&&aC.pageChangeFun!=""&&!aB.data(o.SetPageChange)&&aB.find(".editTip").length<=0){clearTimeout(al);al=setTimeout(function(){if(!aB.data(o.SimpleTextEdit)&&aB.data(o.PreHtmlContent)==""){aB.data(o.PreHtmlContent,aB.html())}if(aB.data(o.PreHtmlContent)!=aB.html()){aB.data(o.SetPageChange,true);f.fkEval(aC.pageChangeFun)}},200)}!aC.btnModuleEdit&&_EditorBase.getEventCtrl().refeshEidtorHeight(az)}if(E(this).hasClass("fk-editor-vertical-rl")&&E(this).attr("_autoWidth")=="1"){aA.css("width",E(this).width()+"px")}aB.data(o.ChangeCount,(parseInt(aB.data(o.ChangeCount))+1));if(!aB.data(o.RemoveUselessChildIng)){aB.data(o.HasRemoveUselessChild,false)}clearTimeout(at);at=setTimeout(function(){_EditToolBase.getEventCtrl().calcuToolBarPos(az)},300)}).unbind(an).bind(an,function(aF){_EditColorBtn.getEventCtrl().backTextSelectedStatus(az);_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aC);!aC.btnModuleEdit&&_EditorBase.getEventCtrl().refeshEidtorHeight(az);_EditorBase.getEventCtrl().logEditorSingleClick(az);_EditorBase.getEventCtrl().stopBannerJump({clickEvent:aF})}).unbind(ap).bind(ap,function(){_EditToolBase.getEventCtrl().showToolBar(az)}).unbind(ao).bind(ao,function(){aA.data(o.HoverToolOn,false);if(aB.data(o.HasRefreshClick)){h.getEventCtrl().getSelectText(aB,false)}}).unbind(aq).bind(aq,function(aF){if(aF.button!=0){return}aA.data(o.Mousemove,false);aA.data(o.Mousedown,true);aA.data(o.ScreenX,aF.screenX);aA.data(o.ScreenY,aF.screenY);setTimeout(function(){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(aC);_EditBtnBase.getEventCtrl().buttonEmphasize(az)},100);aB.data(o.HasRefreshClick,true)}).unbind(av).bind(av,function(aI){if(!aA.data(o.Mousedown)){return}if(aA.data(o.ScreenX)>0){var aH=aI.screenX,aG=aI.screenY,aF=Math.pow((aA.data(o.ScreenX)-aH),2)+Math.pow((aA.data(o.ScreenY)-aG),2);if(aF>1){aA.data(o.Mousemove,true)}}}).unbind(ay).bind(ay,function(aH){if(aH.button!=0){return}var aG=aB.attr(N.Contenteditable),aF;if(!aA.data(o.Mousemove)&&(aG==true||aG=="true")){aA.addClass("formLockEdit");aA.removeClass("fk-hoverModule");aB.focus().find(".editTip").remove();clearTimeout(ax);ax=setTimeout(function(){_EditLinkBtn.getEventCtrl().handTagANotJump(aB);aB.css("cursor","text").attr(N.Contenteditable,true);if(!aB.data(o.FirstChooseEditor)){aB.data(o.FirstChooseEditor,true);T.getEventCtrl().textPositionCorrect(aB);if(aB.find(".editTip").length>0){aB.data(o.PreHtmlContent,"")}else{aB.data(o.PreHtmlContent,aB.html())}}aB.trigger("mouseover")},50);aB.trigger("mouseover");!aC.btnModuleEdit&&_EditorBase.getEventCtrl().refeshEidtorHeight(az)}if(!aA.data(o.Mousemove)){aA.data(o.Mousedown,false)}aA.data(o.Mousemove,false)}).unbind(aw).bind(aw,function(){setTimeout(function(){_EditBtnBase.getEventCtrl().buttonEmphasize(az)},100)}).focus(function(){if(aC.focusFun&&aC.focusFun!=""){f.fkEval(aC.focusFun)}if(J){var aF=e.createRange();aF.selectNodeContents(aB[0]);aF.collapse(false);h.getEventCtrl().setSelectRange(aF)}}).focusout(function(){var aF=aD.find(".tool");aA.data(o.Mousedown,false);if(aC.blurFun&&aC.blurFun!=""){f.fkEval(aC.blurFun)}aB.data(o.Onfocused,false)})}};return ai=new ak()};this.getUICtrl=function(){if(ah){return ah}var ak=function(){var al=this;al.constructor.prototype.creatFkEditorWrapDom=function(an){var ar=an.option,ap=an.element,am=ap.parent("."+ar.css+"-wrap"),aq,ao;if(am.length>0){return}ap.wrap('<div class="'+ar.css+'-wrap"></div>');am=ap.parent("."+ar.css+"-wrap");ao=[];ao.push('<div id="'+ar.css+"-"+ar.moduleId+'" class="fk-editor fkEditor '+ar.extClasses+'" style="width:'+ar.editorWidth+"; height:"+ar.editorHeight+'; border:0px;" _width="'+ar.editorWidth+'" _height="'+ar.editorHeight+'" onpaste="Site.simpleTextFormatPasteData(event, \''+ar.moduleId+"')\" "+N.Contenteditable+"=false >");if(ar.showEditTipWord){ao.push('<div class="editTip">'+ar.editTipWord+"</div>")}else{ao.push(ap.html())}ao.push("</div>");am.html(ao.join(""));return aj}};return ah=new ak()}};_FkEditor=new i();ag.checkSimpleTextHideTool=function(ah){if(ag.simpleTextList.checking!=false){return}ag.simpleTextList.checking=true;setTimeout(function(){if(ag.simpleTextList.allEditors){var ak="",am,ar,ax,av="",an,ay,ai,aw,au=300,at,ao,az=false,aq=false,aj=false,al;for(var ap=0;ap<ag.simpleTextList.allEditors.length;ap++){ak=ag.simpleTextList.allEditors[ap]["moduleId"];if(ah==ak){continue}am=f.top.$("#"+ak);ar=am.find("#fkEditor-"+ak);if(!ar||ar.length<1){ar=ag.simpleTextList.allEditors[ap].editor}az=ar.attr("contenteditable");aq=am.data("hoverToolOn");aj=am.data("mousedown");ax=f.top.$("#fkEditor-toolBar-"+ak);aw=ax.find(".fkEditor-linkSlideBar");if(_EditToolBase.getEventCtrl().isShowHoverToolPanel(ax)){_EditToolBase.getEventCtrl().deleteOrHideToolBar(ar.data("option"));am.data(o.Mousedown,false);continue}if(!aq&&!aj&&(az=="true")){al=ax.find(".simpleTextHoverTool");an=ax.find(".tool-formats").find(".fkEditor-formatBar");ay=ax.find(".tool-fontSize").find(".fkEditor-formatBar");fsizebarTextDiv=ax.find(".tool-fontSize").find(".selectDiv");ai=ax.find(".tool-lineHeight").find(".fkEditor-formatBar");lhbarTextDiv=ax.find(".tool-lineHeight").find(".selectDiv");at=ax.find(".tool-textAlign").find(".fkEditor-formatBar");av=ag.simpleTextList.colorToolShow;if(al.is(":visible")||an.height()>0||ay.height()>0||ai.height()>0||at.height()>0||av){_EditToolBase.getEventCtrl().animateHideToolSecondPanel(ar.data("option"))}else{_EditToolBase.getEventCtrl().deleteOrHideToolBar(ar.data("option"))}}am.data(o.Mousedown,false)}}},50);setTimeout(function(){ag.simpleTextList.checking=false},300)};ag.simpleTextFormatPasteData=function(al,ak){var aj="",ah="";if(ag.simpleTextList.allEditors){for(var ai=0;ai<ag.simpleTextList.allEditors.length;ai++){if(ag.simpleTextList.allEditors[ai]["moduleId"]==ak){ah=ag.simpleTextList.allEditors[ai]["editor"];break}}}setTimeout(function(){_EditorBase.getEventCtrl().simpleTextFormatPasteData(ah.data("editor"),aj)},20);return true};ag.simpleTextSetJumpCtrl=function(){if(f.top._subNavPackEdit){ag.logDog(200256,11)}var ah=f.top.$("#jumpCtrl");var ak=ah.data("moduleId");if(!ag.simpleTextList.allEditors){return}for(var ai=0;ai<ag.simpleTextList.allEditors.length;ai++){if(ag.simpleTextList.allEditors[ai]["moduleId"]==ak){var aj=ag.simpleTextList.allEditors[ai]["editor"];_EditLinkBtn.getEventCtrl().fkEditorSetLink({editor:aj.data("editor"),option:aj.data("option"),jumpCtrl:ah,isGloableLink:false});break}}};ag.simpleTextSetTextColor=function(ah,aj){var ai=ag.simpleTextList.chooseEditor;if(ai){_EditColorBtn.getEventCtrl().simpleTextColorInputHexStatus({state:2,editor:ai.data("editor"),option:ai.data("option"),color:ah,rgbaColor:aj})}};ag.simpleTextColoronShowStatus=function(ah){var ai=ah==1?true:false;ag.simpleTextList.colorToolShow=ai;setTimeout(function(){ag.simpleTextList.colorToolShow=!ai},200)};ag.simpleTextShowGlobalJumpCtrl=function(ai,ah){var ah={showFullMeasure:true,inputId:"jumpHref"+ai,jumpCusId:"jumpCtrl"+ai,moduleType:ah._moduleType,jumpType:ah._ltype,jumpIde:ah._lide,jumpName:ah._lname,jumpTarget:ah._target};ag.jumpControl(ah)};ag.saveTitleJumpUrl=function(aj,ak){if(aj.length<1){return}var an=f.top._titleData,am=f.top.$("#corpTitle"),ai=aj.attr("_lurl"),al=aj.attr("_linkdeleteclick"),ah=parseInt(aj.attr("_ltype"));if(typeof(ai)==l&&!al){return}if(ah==108){an.jm.ot=0}else{an.jm.ot=aj.attr("target")=="_blank"?1:0}if(ai!=null){an.jm.f=aj.attr("_lide");an.jm.jType=ah;an.jm.jUrl=ai;an.jm.y=2;if(ah===2||ah===103){an.jm.jName=ai}else{an.jm.jName=aj.attr("_lname")||an.jm.jName}am.attr("_href",ai);am.css("cursor","pointer")}else{an.jm.jType=0;an.jm.f="";an.jm.y=0;am.removeAttr("_href");am.css("cursor","move")}f.top._titleChanged++;ag.styleChanged();ak.attr(N.Contenteditable,false);return true};ag.simpleTextSaveJumpCtrl=function(ak){var ah=f.top.$("#jumpCtrl"+ak);if(!ag.simpleTextList.allEditors){return false}for(var ai=0;ai<ag.simpleTextList.allEditors.length;ai++){if(ag.simpleTextList.allEditors[ai]["moduleId"]==ak){var aj=ag.simpleTextList.allEditors[ai]["editor"];_EditLinkBtn.getEventCtrl().fkEditorSetLink({editor:aj.data("editor"),option:aj.data("option"),jumpCtrl:ah,isGloableLink:true});f.top.$("#fkEditor-"+ak).attr(N.Contenteditable,false);return true}}return false};ag.simpleTextShowJumpCtrl=function(ai,ah){f.top.$("#jumpCtrl").remove();var ah={showFullMeasure:true,inputId:"simpleTextLinkInputVal-"+ai,moduleType:ah._moduleType,jumpType:ah._ltype,jumpIde:ah._lide,jumpName:ah._lname,jumpTarget:ah._target,setPageChange:ag.simpleTextSetJumpCtrl};ag.jumpControl(ah);setTimeout(function(){f.top.$("#jumpCtrl").data("moduleId",ai).click()},300)};E(function(){var ah="click.simpleTextBodyClick";E(f.top.document.body).children().unbind(ah).bind(ah,function(ai){if(ai.button!=0){return}ag.checkSimpleTextHideTool()})});E.fn.fkEditor=function(al){var ak={moduleId:"module0",editorName:"",css:"fkEditor",endCheckClass:"fkEditor-wrap",editSignClass:"fk-c-",btnModuleEdit:false,tipTitle:false,editorWidth:"200px",editorHeight:"60px",defultContent:"",showEditTipWord:false,editTipWord:"双击输入内容...",changeCount:1,systemModule:"",extClasses:"",toolExtClasses:"",isSystemModule:false,toolBarWidth:"154px",changeFun:"",focusFun:"",blurFun:"",pageChangeFun:"",deleteFun:"",jumpCtrlFun:"",globalJumpCtrlFun:"",saveGlobalJumpCtrlFun:"",animationFun:"",editModuleFun:"",positionFixedFun:"",logoDisplayFun:"",EditContentBtn:{name:"编辑文本"},EditFormatsBtn:{name:"字体",selectedData:[["宋体, SimSun","宋体"],["新细明体, PMingLiU","新细明体"],["仿宋_GB2312,FangSong_GB2312","仿宋_GB2312"],["微软雅黑, Microsoft YaHei","微软雅黑"],["Arial,微软雅黑","Arial"],["隶书, SimLi","隶书"],["幼圆","幼圆"],["华文楷体 ,STKaiti","华文楷体"],["方正舒体","方正舒体"],["华文行楷","华文行楷"],["华文彩云","华文彩云"],["华文宋体","华文宋体"],["楷体 ,楷体_GB2312,SimKai","楷体"],["黑体, SimHei","黑体"],["Tahoma, 微软雅黑","Tahoma"],["impact, 微软雅黑","impact"],["Arial Serif, 微软雅黑","Arial Serif"],["Times New Roman, 微软雅黑","Times New Roman"],["Georgia, 微软雅黑","Georgia"],["Garamond, 微软雅黑","Garamond"],["andale mono, 微软雅黑","andale mono"],["arial black, avant garde, 微软雅黑","arial black"],["comic sans ms, 微软雅黑","comic sans ms"]]},EditFontSizeBtn:{name:"大小",selectedData:[["12px","12px"],["14px","14px"],["16px","16px"],["18px","18px"],["20px","20px"],["24px","24px"],["30px","30px"],["36px","36px"],["48px","48px"],["60px","60px"],["72px","72px"],["84px","84px"],["96px","96px"],["108px","108px"],["120px","120px"]]},EditLineHeightBtn:{name:"行高",selectedData:[["12px","12px"],["14px","14px"],["16px","16px"],["18px","18px"],["20px","20px"],["24px","24px"],["30px","30px"],["36px","36px"],["48px","48px"],["60px","60px"],["72px","72px"],["84px","84px"],["96px","96px"],["108px","108px"],["120px","120px"]]},EditTextAlignBtn:{name:"对齐方式",selectedData:[["justifyLeft","左对齐","justify justifyLeft"],["justifyCenter","居中对齐","justify justifyCenter"],["justifyRight","右对齐","justify justifyRight"]]},HoverTool:{show:true,width:"154px",animationShowWidth:"186px",height:"42px",ToolBtnOrder:["EditContentBtn","EditSeperatorBtn","EditAnimationBtn","EditGlobalLinkBtn","EditDeleteBtn"]},Tool:{show:true,width:"300px",height:"82px",ToolBtnOrder:["EditColorBtn","EditFormatsBtn","EditFontSizeBtn","EditBreakLineBtn","EditBoldBtn","EditItalicBtn","EditUnderlineBtn","EditSeperatorBtn","EditWritingModeBtn","EditLineHeightBtn","EditTextAlignBtn","EditSeperatorBtn","EditLinkBtn","EditRemoveFormatBtn"]}};var ao=E.extend(ak,al),ah=E(this),an,aj,ai,am=_EditorBase.getEventCtrl().getModule({option:ao});if(!am||am.length<=0){return}r?ao.changeCount++:"";if(!ao.btnModuleEdit){_FkEditor.getUICtrl().creatFkEditorWrapDom({option:ao,element:ah});an=E("#"+ao.css+"-"+ao.moduleId);aj=ah.parent("."+ao.css+"-wrap");_EditorBase.getEventCtrl().bindAllEvent({option:ao,module:am,editor:an,fkEditorWrap:aj})}else{an=am.find("#"+ao.moduleId+"FlBtn");aj=an;_EditorBase.getEventCtrl().bindAllEvent({option:ao,module:am,editor:an,fkEditorWrap:aj})}an.data(o.ScrollChangeChecking,false);an.data(o.Onfocused,false);an.data(o.SetPageChange,false);an.data(o.LinkHasClick,false);an.data(o.ClearSpanCursoring,false);an.data(o.HasRefreshClick,false);an.data(o.PreHtmlContent,"");an.data(o.HasRsChildStyle,0);an.data(o.EditSignClass,ao.editSignClass);an.data(o.SignClassNum,1);an.data(o.Option,ao);an.data(o.ChangeCount,0);an.data(o.FirstChooseEditor,false);an.data(o.HasRemoveUselessChild,true);an.data(o.RemoveUselessChildIng,false);an.data(o.EndCheckClass,ao.endCheckClass);an.data(o.EditorEventBind,false);an.data(o.Option,ao);an.data(o.OuterFun,_EditorOuterFunc.getEventCtrl().getOuterFunc());an.data(o.Editor,an);ag.simpleTextList.allEditors.push({moduleId:ao.moduleId,editor:an});return an}})(jQuery,window,document,Fai?Fai:{},"undefined");